{"version":3,"sources":["exported-GameBox.js"],"names":["fileSystemManager","require","KEY","VERSION","cc","Class","extends","Component","properties","itemBox","default","type","Node","gamePrefab","Prefab","gamePrefabScript","canvas","layout","waiting","layer","version","Label","init","gameName","loadString","sys","localStorage","getItem","length","setItem","JSON","stringify","CC_WECHATGAME","string","initItemBox","initLayout","initJson","isRunningA","self","urlPath","loader","load","err","res","console","log","addList","serverString","newlist","initList","UpdateLocal","serverData","parse","localData","array","Object","keys","data","forEach","element","logo","removeFile","url","success","title","qrcode","list","node","instantiate","getComponent","width","winSize","name","appid","spriteFrame","style","btnCallback","bind","parent","getFile","remoteUrl","texture","SpriteFrame","setSpriteFrame","fail","default_icon_url_head","desc","active","wx","navigateToMiniProgram","appId","path","errMsg","indexOf","showQR","previewImage","urls","windowSize","height","top","spacingX","spacingY","paddingTop","paddingBottom","paddingLeft","show","first","callFunc","startPosition","position","move","moveTo","v2","finished","callback","setGameLogo","seq","sequence","runAction","hide","readBtn","showFile","clearLocsl","removeAllFile"],"mappings":";;;;;;AAAA,IAAIA,oBAAoBC,QAAQ,yBAAR,CAAxB;AACA,IAAMC,MAAM,YAAZ;AACA,IAAMC,UAAU,OAAhB;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,iBAAS;AACLC,qBAAS,EADJ;AAELC,kBAAMP,GAAGQ;AAFJ,SADD;;AAMRC,oBAAYT,GAAGU,MANP;AAORC,0BAAkB,EAPV;;AASRC,gBAAQZ,GAAGQ,IATH;AAURK,gBAAQb,GAAGQ,IAVH;AAWRM,iBAASd,GAAGQ,IAXJ;AAYRO,eAAOf,GAAGQ,IAZF;;AAcRQ,iBAAShB,GAAGiB;;AAEZ;;AAhBQ,KAHP;;AAuBLC,UAAM,cAAUC,QAAV,EAAoB;AACtB,YAAIC,aAAapB,GAAGqB,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4BzB,GAA5B,CAAjB;AACA,YAAKsB,cAAc,IAAf,IAAyBA,WAAWI,MAAX,IAAqB,CAAlD,EAAsD;AAClDxB,eAAGqB,GAAH,CAAOC,YAAP,CAAoBG,OAApB,CAA4B3B,GAA5B,EAAiC4B,KAAKC,SAAL,CAAe,EAAf,CAAjC;AACH;;AAED,YAAIC,aAAJ,EAAmB;AACfhC,8BAAkBsB,IAAlB,CAAuB,YAAvB,EAAqCC,QAArC;AACH;;AAED,aAAKH,OAAL,CAAaa,MAAb,GAAsB,OAAO9B,OAA7B;;AAEA,aAAK+B,WAAL;AACA,aAAKC,UAAL;AACA,aAAKC,QAAL,CAAcb,QAAd;AACA,aAAKc,UAAL,GAAkB,IAAlB;AACH,KAvCI;;AAyCLD,cAAU,kBAAUb,QAAV,EAAoB;AAC1B,YAAIe,OAAO,IAAX;AACA,YAAIC,UAAU,wHAAwHhB,QAAtI;AACA;AACAnB,WAAGoC,MAAH,CAAUC,IAAV,CAAeF,OAAf,EAAwB,UAAUG,GAAV,EAAeC,GAAf,EAAoB;AACxC,gBAAID,GAAJ,EACIE,QAAQC,GAAR,CAAYH,GAAZ,EADJ,KAEK;AACD;AACAJ,qBAAKQ,OAAL,CAAaH,GAAb;AACH;AACJ,SAPD;;AAUA;AACA;AACA;AACH,KA1DI;;AA4DLG,aAAS,iBAAUH,GAAV,EAAe;AACpB,YAAIL,OAAO,IAAX;AACAA,aAAKS,YAAL,GAAoBJ,GAApB;AACAL,aAAKd,UAAL,GAAkBpB,GAAGqB,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4BzB,GAA5B,CAAlB;AACAoC,aAAKU,OAAL,GAAe,EAAf;;AAEAV,aAAKW,QAAL;AACAX,aAAKY,WAAL;AACH,KApEI;;AAsELA,iBAAa,uBAAY;AAAA;;AACrBN,gBAAQC,GAAR,CAAY,QAAZ;;AAEA,YAAIM,aAAarB,KAAKsB,KAAL,CAAW,KAAKL,YAAhB,CAAjB;AACA,YAAIM,YAAYvB,KAAKsB,KAAL,CAAWhD,GAAGqB,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4BzB,GAA5B,CAAX,CAAhB;;AAEA,YAAIoD,QAAQC,OAAOC,IAAP,CAAYH,SAAZ,CAAZ;;AAEAT,gBAAQC,GAAR,CAAY,OAAZ,EAAqBS,MAAM1B,MAA3B;AACAgB,gBAAQC,GAAR,CAAY,QAAZ,EAAsBM,WAAWM,IAAX,CAAgB7B,MAAtC;;AAEA0B,cAAMI,OAAN,CAAc,mBAAW;AACrB,gBAAI,MAAKV,OAAL,CAAaW,OAAb,CAAJ,EAA2B;;AAEvB,oBAAI,MAAKX,OAAL,CAAaW,OAAb,EAAsBC,IAAtB,IAA8BP,UAAUM,OAAV,EAAmBC,IAArD,EAA2D;AACvD,wBAAI5B,aAAJ,EAAmB;AACfhC,0CAAkB6D,UAAlB,CAA6B;AACzBC,iCAAKT,UAAUM,OAAV,EAAmBC,IADC;AAEzBG,qCAAS,mBAAY;AACjBnB,wCAAQC,GAAR,CAAY,MAAZ;AACH;AAJwB,yBAA7B;AAMH,qBAPD,MAOO;AACHD,gCAAQC,GAAR,CAAY,WAAWQ,UAAUM,OAAV,EAAmBK,KAA9B,GAAsC,OAAlD;AACApB,gCAAQC,GAAR,CAAY,WAAWQ,UAAUM,OAAV,EAAmBC,IAA1C;AAEH;AACJ;;AAED,oBAAI,MAAKZ,OAAL,CAAaW,OAAb,EAAsBM,MAAtB,IAAgCZ,UAAUM,OAAV,EAAmBM,MAAvD,EAA+D;AAC3D,wBAAIjC,aAAJ,EAAmB;AACfhC,0CAAkB6D,UAAlB,CAA6B;AACzBC,iCAAKT,UAAUM,OAAV,EAAmBM,MADC;AAEzBF,qCAAS,mBAAY;AACjBnB,wCAAQC,GAAR,CAAY,MAAZ;AACH;AAJwB,yBAA7B;AAMH,qBAPD,MAOO;AACHD,gCAAQC,GAAR,CAAY,WAAWQ,UAAUM,OAAV,EAAmBK,KAA9B,GAAsC,SAAlD;AACApB,gCAAQC,GAAR,CAAY,WAAWQ,UAAUM,OAAV,EAAmBM,MAA1C;AAEH;AACJ;AAEJ,aAhCD,MAgCO;AACHrB,wBAAQC,GAAR,CAAY,KAAZ;AACAD,wBAAQC,GAAR,CAAY,SAASQ,UAAUM,OAAV,EAAmBK,KAA5B,GAAoC,MAAhD;;AAEA,oBAAIhC,aAAJ,EAAmB;AACfhC,sCAAkB6D,UAAlB,CAA6B;AACzBC,6BAAKT,UAAUM,OAAV,EAAmBC,IADC;AAEzBG,iCAAS,mBAAY;AACjBnB,oCAAQC,GAAR,CAAY,MAAZ;AACH;AAJwB,qBAA7B;AAMA7C,sCAAkB6D,UAAlB,CAA6B;AACzBC,6BAAKT,UAAUM,OAAV,EAAmBM,MADC;AAEzBF,iCAAS,mBAAY;AACjBnB,oCAAQC,GAAR,CAAY,MAAZ;AACH;AAJwB,qBAA7B;AAMH,iBAbD,MAaO;AACHD,4BAAQC,GAAR,CAAY,WAAWQ,UAAUM,OAAV,EAAmBK,KAA9B,GAAsC,MAAlD;AACH;AACJ;AACJ,SAtDD;;AAwDApB,gBAAQC,GAAR,CAAY,QAAZ;AACAzC,WAAGqB,GAAH,CAAOC,YAAP,CAAoBG,OAApB,CAA4B3B,GAA5B,EAAiC4B,KAAKC,SAAL,CAAe,KAAKiB,OAApB,CAAjC;AAEH,KA5II;;AA8ILC,cAAU,oBAAY;AAAA;;AAClB,YAAIX,OAAO,IAAX;AACA,YAAI4B,OAAOpC,KAAKsB,KAAL,CAAW,KAAKL,YAAhB,EAA8BU,IAAzC;;AAEAS,aAAKR,OAAL,CAAa,mBAAW;AACpB,gBAAIS,OAAO/D,GAAGgE,WAAH,CAAe9B,KAAKzB,UAApB,CAAX;;AAEAsD,iBAAKE,YAAL,CAAkB/B,KAAKvB,gBAAvB,EAAyCO,IAAzC,CAA8C;AAC1CgD,uBAAOlE,GAAGmE,OAAH,CAAWD,KAAX,GAAmB,GADgB;AAE1CE,sBAAMb,QAAQK,KAF4B;AAG1CS,uBAAOd,QAAQc,KAH2B;AAI1CC,6BAAa,IAJ6B;AAK1CC,uBAAOhB,QAAQgB,KAL2B;AAM1CV,wBAAQN,QAAQM,MAN0B;AAO1CW,6BAAatC,KAAKsC,WAAL,CAAiBC,IAAjB,CAAsBvC,IAAtB;AAP6B,aAA9C;;AAUA6B,iBAAKW,MAAL,GAAcxC,KAAK7B,OAAL,CAAakD,QAAQhD,IAAR,GAAe,CAA5B,CAAd;;AAEA,gBAAIqB,aAAJ,EAAmB;AACfhC,kCAAkB+E,OAAlB,CAA0B;AACtBjB,yBAAKH,QAAQC,IADS;AAEtBG,6BAAS,iBAAUiB,SAAV,EAAqB;AAC1B5E,2BAAGoC,MAAH,CAAUC,IAAV,CAAeuC,SAAf,EAA0B,UAAUtC,GAAV,EAAeuC,OAAf,EAAwB;;AAE9C,gCAAIP,cAAc,IAAItE,GAAG8E,WAAP,CAAmBD,OAAnB,CAAlB;AACAd,iCAAKE,YAAL,CAAkB/B,KAAKvB,gBAAvB,EAAyCoE,cAAzC,CAAwDT,WAAxD;AAEH,yBALD;AAMH,qBATqB;AAUtBU,0BAAM,gBAAY;AACdxC,gCAAQC,GAAR,CAAY,QAAZ;AACH;AAZqB,iBAA1B;AAcH,aAfD,MAeO;AACH,oBAAIwC,wBAAwB,wCAA5B;AACA,oBAAI9C,UAAU8C,wBAAwB1B,QAAQC,IAA9C;AACA,oBAAIE,MAAM,EAAEA,KAAKvB,UAAU,MAAjB,EAAyB5B,MAAM,KAA/B,EAAV;AACA;AACAiC,wBAAQC,GAAR,CAAYiB,GAAZ;AACA1D,mBAAGoC,MAAH,CAAUC,IAAV,CAAeqB,GAAf,EAAoB,UAAUpB,GAAV,EAAeuC,OAAf,EAAwB;AACxC,wBAAIP,cAAc,IAAItE,GAAG8E,WAAP,CAAmBD,OAAnB,CAAlB;AACAd,yBAAKE,YAAL,CAAkB/B,KAAKvB,gBAAvB,EAAyCoE,cAAzC,CAAwDT,WAAxD;AACH,iBAHD;AAIH;;AAED,mBAAK1B,OAAL,CAAaW,QAAQc,KAArB,IAA8B;AAC1Ba,sBAAM3B,QAAQ2B,IADY;AAE1BtB,uBAAOL,QAAQK,KAFW;AAG1BJ,sBAAMD,QAAQC,IAHY;AAI1BK,wBAAQN,QAAQM;AAJU,aAA9B;AAMH,SAhDD;AAiDH,KAnMI;;AAsMLW,iBAAa,qBAAUjC,GAAV,EAAe;AACxBC,gBAAQC,GAAR,CAAYF,GAAZ;AACA,YAAI8B,QAAQ9B,IAAI8B,KAAhB;AACA,YAAIR,SAAStB,IAAIsB,MAAjB;AACA,YAAI3B,OAAO,IAAX;AACAA,aAAKpB,OAAL,CAAaqE,MAAb,GAAsB,IAAtB;;AAEA,YAAIvD,aAAJ,EAAmB;AACf,gBAAIwD,GAAGC,qBAAP,EAA8B;;AAE1BD,mBAAGC,qBAAH,CAAyB;AACrBC,2BAAOjB,KADc;AAErBkB,0BAAM,EAFe;AAGrB5B,2BAHqB,qBAGX;AACNnB,gCAAQC,GAAR,CAAY,MAAZ;;AAEAP,6BAAKpB,OAAL,CAAaqE,MAAb,GAAsB,KAAtB;AACH,qBAPoB;;AAQrBH,0BAAM,cAAU1C,GAAV,EAAe;AACjBE,gCAAQC,GAAR,CAAYH,GAAZ;;AAEA,4BAAIA,IAAIkD,MAAJ,CAAWC,OAAX,CAAmB,aAAnB,KAAqC,CAAC,CAA1C,EAA6C;AACzCvD,iCAAKwD,MAAL,CAAY;AACR7B,wCAAQA;AADA,6BAAZ;AAGH,yBAJD,MAIO;AACH3B,iCAAKpB,OAAL,CAAaqE,MAAb,GAAsB,KAAtB;AACH;AACJ;AAlBoB,iBAAzB;AAqBH,aAvBD,MAuBO;;AAEH3C,wBAAQC,GAAR,CAAY,6BAAZ;;AAEAP,qBAAKwD,MAAL,CAAY;AACR7B,4BAAQA;AADA,iBAAZ;AAIH;AAEJ,SAlCD,MAkCO;;AAEH3B,iBAAKpB,OAAL,CAAaqE,MAAb,GAAsB,KAAtB;AAEH;AACJ,KApPI;;AAsPLO,YAAQ,gBAAUnD,GAAV,EAAe;AACnB,YAAIL,OAAO,IAAX;AACAtC,0BAAkB+E,OAAlB,CAA0B;AACtBjB,iBAAKnB,IAAIsB,MADa;AAEtBF,qBAAS,iBAAUiB,SAAV,EAAqB;AAC1BQ,mBAAGO,YAAH,CAAgB;AACZC,0BAAM,CAAChB,SAAD,CADM;AAEZjB,6BAAS,mBAAY;AACjBzB,6BAAKpB,OAAL,CAAaqE,MAAb,GAAsB,KAAtB;AACA3C,gCAAQC,GAAR,CAAY,kCAAZ;AACH;AALW,iBAAhB;AAOH,aAVqB;AAWtBuC,kBAAM,gBAAY;AACdxC,wBAAQC,GAAR,CAAY,QAAZ;AACAP,qBAAKpB,OAAL,CAAaqE,MAAb,GAAsB,KAAtB;AACH;AAdqB,SAA1B;AAgBH,KAxQI;;AA0QLpD,gBAAY,sBAAY;AACpB,YAAI8D,aAAa7F,GAAGmE,OAApB;AACA,YAAI0B,WAAWC,MAAX,GAAoBD,WAAW3B,KAA/B,IAAwC,GAA5C,EAAiD;AAC7C,iBAAKrD,MAAL,CAAYoD,YAAZ,CAAyB,WAAzB,EAAsC8B,GAAtC,GAA4C,EAA5C;AACH;AACJ,KA/QI;;AAiRLjE,iBAAa,uBAAY;;AAErB,aAAKzB,OAAL,CAAaiD,OAAb,CAAqB,mBAAW;AAC5BC,oBAAQU,YAAR,CAAqB,WAArB,EAAkC+B,QAAlC,GAA6ChG,GAAGmE,OAAH,CAAWD,KAAX,GAAmB,IAAhE;AACAX,oBAAQU,YAAR,CAAqB,WAArB,EAAkCgC,QAAlC,GAA6CjG,GAAGmE,OAAH,CAAWD,KAAX,GAAmB,IAAhE;;AAEAX,oBAAQU,YAAR,CAAqB,WAArB,EAAkCiC,UAAlC,GAA+ClG,GAAGmE,OAAH,CAAWD,KAAX,GAAmB,IAAlE;AACAX,oBAAQU,YAAR,CAAqB,WAArB,EAAkCkC,aAAlC,GAAkDnG,GAAGmE,OAAH,CAAWD,KAAX,GAAmB,IAArE;;AAEAX,oBAAQU,YAAR,CAAqB,WAArB,EAAkCmC,WAAlC,GAAgDpG,GAAGmE,OAAH,CAAWD,KAAX,GAAmB,IAAnE;AACH,SARD;AAUH,KA7RI;;AA+RLmC,UAAM,cAAUhD,IAAV,EAAgB;AAC1BrD,WAAGyC,GAAH,CAAO,cAAP;AACQ,YAAIP,OAAO,IAAX;AACA,YAAIoE,QAAQtG,GAAGuG,QAAH,CAAY,YAAY;AAChC,iBAAKC,aAAL,GAAqB,KAAK5F,MAAL,CAAY6F,QAAjC;;AAEAvE,iBAAKD,UAAL,GAAkB,KAAlB;AACH,SAJW,EAIT,IAJS,CAAZ;AAKA,YAAIyE,OAAO1G,GAAG2G,MAAH,CAAU,GAAV,EAAe3G,GAAG4G,EAAH,CAAM,CAAN,EAAS,CAAT,CAAf,CAAX;AACA,YAAIC,WAAW7G,GAAGuG,QAAH,CAAY,YAAY;AACnCrE,iBAAKD,UAAL,GAAkB,IAAlB;;AAEAoB,iBAAKyD,QAAL,IAAiBzD,KAAKyD,QAAL,EAAjB;;AAEA,gBAAIzD,KAAKgB,KAAT,EAAgB;AACZ,oBAAInC,KAAKU,OAAL,CAAaS,KAAKgB,KAAlB,CAAJ,EAA8B;AAC1B,yBAAKtD,KAAL,CAAWkD,YAAX,CAAwB,gBAAxB,EAA0C/C,IAA1C,CAA+C;AAC3CmD,+BAAOhB,KAAKgB,KAD+B;AAE3CT,+BAAO1B,KAAKU,OAAL,CAAaS,KAAKgB,KAAlB,EAAyBT,KAFW;AAG3CsB,8BAAMhD,KAAKU,OAAL,CAAaS,KAAKgB,KAAlB,EAAyBa,IAHY;AAI3CrB,gCAAQ3B,KAAKU,OAAL,CAAaS,KAAKgB,KAAlB,EAAyBR,MAJU;AAK3CiD,kCAAU5E,KAAKsC,WAAL,CAAiBC,IAAjB,CAAsBvC,IAAtB;AALiC,qBAA/C;;AAQA,wBAAIN,aAAJ,EAAmB;AACfhC,0CAAkB+E,OAAlB,CAA0B;AACtBjB,iCAAKxB,KAAKU,OAAL,CAAaS,KAAKgB,KAAlB,EAAyBb,IADR;AAEtBG,qCAAS,iBAAUiB,SAAV,EAAqB;AAC1B5E,mCAAGoC,MAAH,CAAUC,IAAV,CAAeuC,SAAf,EAA0B,UAAUtC,GAAV,EAAeuC,OAAf,EAAwB;;AAE9C,wCAAIP,cAAc,IAAItE,GAAG8E,WAAP,CAAmBD,OAAnB,CAAlB;AACA3C,yCAAKnB,KAAL,CAAWkD,YAAX,CAAwB,gBAAxB,EAA0C8C,WAA1C,CAAsDzC,WAAtD;AAEH,iCALD;AAMH,6BATqB;AAUtBU,kCAAM,gBAAY;AACdxC,wCAAQC,GAAR,CAAY,QAAZ;AACH;AAZqB,yBAA1B;AAcH;AACD,yBAAK1B,KAAL,CAAWoE,MAAX,GAAoB,IAApB;AACH,iBA1BD,MA0BO;AACH3C,4BAAQC,GAAR,CAAY,KAAZ;AACH;AACJ;AACJ,SApCc,EAoCZ,IApCY,CAAf;;AAsCA,YAAIuE,MAAMhH,GAAGiH,QAAH,CACNX,KADM,EAENI,IAFM,EAGNG,QAHM,CAAV;;AAMA,YAAI,KAAK5E,UAAT,EAAqB;AACjB,iBAAKrB,MAAL,CAAYsG,SAAZ,CAAsBF,GAAtB;AACH;AACJ,KAvVI;;AAyVLG,UAAM,cAAU9D,IAAV,EAAgB;AAClB,YAAInB,OAAO,IAAX;AACA,YAAIoE,QAAQtG,GAAGuG,QAAH,CAAY,YAAY;AAChCrE,iBAAKD,UAAL,GAAkB,KAAlB;AACH,SAFW,EAET,IAFS,CAAZ;AAGA,YAAIyE,OAAO1G,GAAG2G,MAAH,CAAU,GAAV,EAAe,KAAKH,aAApB,CAAX;AACA,YAAIK,WAAW7G,GAAGuG,QAAH,CAAY,YAAY;AACnCrE,iBAAKD,UAAL,GAAkB,IAAlB;;AAEAoB,iBAAKyD,QAAL;AACH,SAJc,EAIZ,IAJY,CAAf;;AAMA,YAAIE,MAAMhH,GAAGiH,QAAH,CACNX,KADM,EAENI,IAFM,EAGNG,QAHM,CAAV;;AAMA,YAAI,KAAK5E,UAAT,EAAqB;AACjB,iBAAKrB,MAAL,CAAYsG,SAAZ,CAAsBF,GAAtB;AACH;AACJ,KA9WI;;AAgXL;AACAI,aAAS,mBAAY;AACjB,YAAIxF,aAAJ,EAAmB;AACfhC,8BAAkByH,QAAlB;AACH,SAFD,MAEO;AACH,gBAAIpE,YAAYvB,KAAKsB,KAAL,CAAWhD,GAAGqB,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4BzB,GAA5B,CAAX,CAAhB;AACA;AACA,gBAAImD,aAAa,MAAjB,EAAyB;AACrB,oBAAIC,QAAQC,OAAOC,IAAP,CAAYH,SAAZ,CAAZ;AACAT,wBAAQC,GAAR,CAAYS,KAAZ;AACH,aAHD,MAGO;AACHV,wBAAQC,GAAR,CAAY,GAAZ;AACH;AACJ;AACJ,KA9XI;;AAgYL6E,gBAAY,sBAAY;AACpBtH,WAAGqB,GAAH,CAAOC,YAAP,CAAoBG,OAApB,CAA4B3B,GAA5B,EAAiC4B,KAAKC,SAAL,CAAe,EAAf,CAAjC;AACH,KAlYI;;AAoYL4F,mBAAe,yBAAY;;AAEvB,YAAI3F,aAAJ,EAAmB;AACf,gBAAIR,aAAapB,GAAGqB,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4BzB,GAA5B,CAAjB;AACA,gBAAImD,YAAYvB,KAAKsB,KAAL,CAAW5B,UAAX,CAAhB;AACA,gBAAI8B,QAAQC,OAAOC,IAAP,CAAYH,SAAZ,CAAZ;AACAT,oBAAQC,GAAR,CAAYS,KAAZ;;AAEAA,kBAAMI,OAAN,CAAc,mBAAW;;AAErB1D,kCAAkB6D,UAAlB,CAA6B;AACzBC,yBAAKT,UAAUM,OAAV,EAAmBC,IADC;AAEzBG,6BAAS,mBAAY;AACjBnB,gCAAQC,GAAR,CAAY,MAAZ;AACH;AAJwB,iBAA7B;;AAOA7C,kCAAkB6D,UAAlB,CAA6B;AACzBC,yBAAKT,UAAUM,OAAV,EAAmBM,MADC;AAEzBF,6BAAS,mBAAY;AACjBnB,gCAAQC,GAAR,CAAY,MAAZ;AACH;AAJwB,iBAA7B;AAMH,aAfD;AAgBAzC,eAAGqB,GAAH,CAAOC,YAAP,CAAoBG,OAApB,CAA4B3B,GAA5B,EAAiC4B,KAAKC,SAAL,CAAe,EAAf,CAAjC;AACH,SAvBD,MAuBO;AACH3B,eAAGqB,GAAH,CAAOC,YAAP,CAAoBG,OAApB,CAA4B3B,GAA5B,EAAiC4B,KAAKC,SAAL,CAAe,EAAf,CAAjC;AACH;AAGJ;;AAlaI,CAAT","file":"exported-GameBox.js","sourceRoot":"../../../../../../assets/Prefab/GameBox-master/script","sourcesContent":["var fileSystemManager = require(\"WeChatFileSystemManager\");\nconst KEY = \"NewGameBox\";\nconst VERSION = \"1.0.1\";\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemBox: {\n            default: [],\n            type: cc.Node,\n        },\n\n        gamePrefab: cc.Prefab,\n        gamePrefabScript: \"\",\n\n        canvas: cc.Node,\n        layout: cc.Node,\n        waiting: cc.Node,\n        layer: cc.Node,\n\n        version: cc.Label,\n\n        // gameBoxJson: cc.JsonAsset,\n\n    },\n\n    init: function (gameName) {\n        var loadString = cc.sys.localStorage.getItem(KEY);\n        if ((loadString == null) || (loadString.length == 0)) {\n            cc.sys.localStorage.setItem(KEY, JSON.stringify({}));\n        }\n\n        if (CC_WECHATGAME) {\n            fileSystemManager.init(\"NewGameBox\", gameName);\n        }\n\n        this.version.string = \"V \" + VERSION;\n\n        this.initItemBox();\n        this.initLayout();\n        this.initJson(gameName);\n        this.isRunningA = true;\n    },\n\n    initJson: function (gameName) {\n        var self = this;\n        var urlPath = \"https://www.7cgames.cn/transfer.php?url=https://www.7cgames.cn/GameRes/7CGamesBoxWX/NewGameBox/7cgamesBoxData.json?\" + gameName;\n        // var urlPath = \"http://192.168.0.108/transfer.php?url=http://192.168.0.108/GameRes/7CGamesBoxWX/NewGameBox/7cgamesBoxData.json\";\n        cc.loader.load(urlPath, function (err, res) {\n            if (err)\n                console.log(err);\n            else {\n                // console.log(res);\n                self.addList(res);\n            }\n        });\n\n\n        // var json = this.gameBoxJson.json;\n        // // console.log(json);\n        // self.addList(JSON.stringify(json));\n    },\n\n    addList: function (res) {\n        var self = this;\n        self.serverString = res\n        self.loadString = cc.sys.localStorage.getItem(KEY);\n        self.newlist = {};\n\n        self.initList();\n        self.UpdateLocal();\n    },\n\n    UpdateLocal: function () {\n        console.log(\"整体更新本地\");\n\n        var serverData = JSON.parse(this.serverString);\n        var localData = JSON.parse(cc.sys.localStorage.getItem(KEY));\n\n        var array = Object.keys(localData);\n\n        console.log(\"本地个数：\", array.length);\n        console.log(\"服务器个数：\", serverData.data.length);\n\n        array.forEach(element => {\n            if (this.newlist[element]) {\n\n                if (this.newlist[element].logo != localData[element].logo) {\n                    if (CC_WECHATGAME) {\n                        fileSystemManager.removeFile({\n                            url: localData[element].logo,\n                            success: function () {\n                                console.log(\"删除成功\");\n                            },\n                        });\n                    } else {\n                        console.log(\"删除成功: \" + localData[element].title + \",logo\");\n                        console.log(\"删除成功: \" + localData[element].logo);\n\n                    }\n                }\n\n                if (this.newlist[element].qrcode != localData[element].qrcode) {\n                    if (CC_WECHATGAME) {\n                        fileSystemManager.removeFile({\n                            url: localData[element].qrcode,\n                            success: function () {\n                                console.log(\"删除成功\");\n                            },\n                        });\n                    } else {\n                        console.log(\"删除成功: \" + localData[element].title + \",qrcode\");\n                        console.log(\"删除成功: \" + localData[element].qrcode);\n\n                    }\n                }\n\n            } else {\n                console.log(\"不存在\");\n                console.log(\"删除旧的\" + localData[element].title + \"本地文件\");\n\n                if (CC_WECHATGAME) {\n                    fileSystemManager.removeFile({\n                        url: localData[element].logo,\n                        success: function () {\n                            console.log(\"删除成功\");\n                        },\n                    });\n                    fileSystemManager.removeFile({\n                        url: localData[element].qrcode,\n                        success: function () {\n                            console.log(\"删除成功\");\n                        },\n                    });\n                } else {\n                    console.log(\"删除成功: \" + localData[element].title + \"全部文件\");\n                }\n            }\n        });\n\n        console.log(\"整体更新完成\");\n        cc.sys.localStorage.setItem(KEY, JSON.stringify(this.newlist));\n\n    },\n\n    initList: function () {\n        var self = this;\n        var list = JSON.parse(this.serverString).data;\n\n        list.forEach(element => {\n            var node = cc.instantiate(self.gamePrefab);\n\n            node.getComponent(self.gamePrefabScript).init({\n                width: cc.winSize.width * 0.2,\n                name: element.title,\n                appid: element.appid,\n                spriteFrame: null,\n                style: element.style,\n                qrcode: element.qrcode,\n                btnCallback: self.btnCallback.bind(self),\n            });\n\n            node.parent = self.itemBox[element.type - 1];\n\n            if (CC_WECHATGAME) {\n                fileSystemManager.getFile({\n                    url: element.logo,\n                    success: function (remoteUrl) {\n                        cc.loader.load(remoteUrl, function (err, texture) {\n\n                            var spriteFrame = new cc.SpriteFrame(texture);\n                            node.getComponent(self.gamePrefabScript).setSpriteFrame(spriteFrame);\n\n                        });\n                    },\n                    fail: function () {\n                        console.log(\"加载图片失败\");\n                    },\n                });\n            } else {\n                var default_icon_url_head = \"http://192.168.0.108/transfer.php?url=\";\n                var urlPath = default_icon_url_head + element.logo;\n                var url = { url: urlPath + \"?ass\", type: \"png\" };\n                // url = url.url+ \"?\"\n                console.log(url);\n                cc.loader.load(url, function (err, texture) {\n                    var spriteFrame = new cc.SpriteFrame(texture);\n                    node.getComponent(self.gamePrefabScript).setSpriteFrame(spriteFrame);\n                });\n            }\n\n            this.newlist[element.appid] = {\n                desc: element.desc,\n                title: element.title,\n                logo: element.logo,\n                qrcode: element.qrcode,\n            }\n        });\n    },\n\n\n    btnCallback: function (res) {\n        console.log(res);\n        var appid = res.appid;\n        var qrcode = res.qrcode;\n        var self = this;\n        self.waiting.active = true;\n\n        if (CC_WECHATGAME) {\n            if (wx.navigateToMiniProgram) {\n\n                wx.navigateToMiniProgram({\n                    appId: appid,\n                    path: '',\n                    success() {\n                        console.log(\"打开成功\");\n\n                        self.waiting.active = false;\n                    },\n                    fail: function (err) {\n                        console.log(err);\n\n                        if (err.errMsg.indexOf(\"fail cancel\") == -1) {\n                            self.showQR({\n                                qrcode: qrcode,\n                            });\n                        } else {\n                            self.waiting.active = false;\n                        }\n                    },\n                });\n\n            } else {\n\n                console.log(\"navigateToMiniProgram 低版本适配\");\n\n                self.showQR({\n                    qrcode: qrcode,\n                });\n\n            }\n\n        } else {\n\n            self.waiting.active = false;\n\n        }\n    },\n\n    showQR: function (res) {\n        var self = this;\n        fileSystemManager.getFile({\n            url: res.qrcode,\n            success: function (remoteUrl) {\n                wx.previewImage({\n                    urls: [remoteUrl],\n                    success: function () {\n                        self.waiting.active = false;\n                        console.log(\"wei xin previewImage success....\");\n                    }\n                });\n            },\n            fail: function () {\n                console.log(\"加载图片失败\");\n                self.waiting.active = false;\n            },\n        });\n    },\n\n    initLayout: function () {\n        var windowSize = cc.winSize;\n        if (windowSize.height / windowSize.width >= 2.1) {\n            this.layout.getComponent(\"cc.Widget\").top = 40;\n        }\n    },\n\n    initItemBox: function () {\n\n        this.itemBox.forEach(element => {\n            element.getComponent(\"cc.Layout\").spacingX = cc.winSize.width * 0.04;\n            element.getComponent(\"cc.Layout\").spacingY = cc.winSize.width * 0.03;\n\n            element.getComponent(\"cc.Layout\").paddingTop = cc.winSize.width * 0.02;\n            element.getComponent(\"cc.Layout\").paddingBottom = cc.winSize.width * 0.04;\n\n            element.getComponent(\"cc.Layout\").paddingLeft = cc.winSize.width * 0.04;\n        });\n\n    },\n\n    show: function (data) {\ncc.log(\"moregameshow\")\n        var self = this;\n        var first = cc.callFunc(function () {\n            this.startPosition = this.canvas.position;\n\n            self.isRunningA = false;\n        }, this);\n        var move = cc.moveTo(0.3, cc.v2(0, 0));\n        var finished = cc.callFunc(function () {\n            self.isRunningA = true;\n\n            data.callback && data.callback();\n\n            if (data.appid) {\n                if (self.newlist[data.appid]) {\n                    this.layer.getComponent(\"exported-Layer\").init({\n                        appid: data.appid,\n                        title: self.newlist[data.appid].title,\n                        desc: self.newlist[data.appid].desc,\n                        qrcode: self.newlist[data.appid].qrcode,\n                        callback: self.btnCallback.bind(self),\n                    });\n\n                    if (CC_WECHATGAME) {\n                        fileSystemManager.getFile({\n                            url: self.newlist[data.appid].logo,\n                            success: function (remoteUrl) {\n                                cc.loader.load(remoteUrl, function (err, texture) {\n\n                                    var spriteFrame = new cc.SpriteFrame(texture);\n                                    self.layer.getComponent(\"exported-Layer\").setGameLogo(spriteFrame);\n\n                                });\n                            },\n                            fail: function () {\n                                console.log(\"加载图片失败\");\n                            },\n                        });\n                    }\n                    this.layer.active = true;\n                } else {\n                    console.log(\"不存在\");\n                }\n            }\n        }, this);\n\n        var seq = cc.sequence(\n            first,\n            move,\n            finished,\n        );\n\n        if (this.isRunningA) {\n            this.canvas.runAction(seq);\n        }\n    },\n\n    hide: function (data) {\n        var self = this;\n        var first = cc.callFunc(function () {\n            self.isRunningA = false;\n        }, this);\n        var move = cc.moveTo(0.3, this.startPosition);\n        var finished = cc.callFunc(function () {\n            self.isRunningA = true;\n\n            data.callback()\n        }, this);\n\n        var seq = cc.sequence(\n            first,\n            move,\n            finished,\n        );\n\n        if (this.isRunningA) {\n            this.canvas.runAction(seq);\n        }\n    },\n\n    //test\n    readBtn: function () {\n        if (CC_WECHATGAME) {\n            fileSystemManager.showFile();\n        } else {\n            var localData = JSON.parse(cc.sys.localStorage.getItem(KEY));\n            // console.log(localData);\n            if (localData != \"null\") {\n                var array = Object.keys(localData);\n                console.log(array);\n            } else {\n                console.log(\"空\");\n            }\n        }\n    },\n\n    clearLocsl: function () {\n        cc.sys.localStorage.setItem(KEY, JSON.stringify({}));\n    },\n\n    removeAllFile: function () {\n\n        if (CC_WECHATGAME) {\n            var loadString = cc.sys.localStorage.getItem(KEY);\n            var localData = JSON.parse(loadString);\n            var array = Object.keys(localData);\n            console.log(array);\n\n            array.forEach(element => {\n\n                fileSystemManager.removeFile({\n                    url: localData[element].logo,\n                    success: function () {\n                        console.log(\"删除成功\");\n                    },\n                });\n\n                fileSystemManager.removeFile({\n                    url: localData[element].qrcode,\n                    success: function () {\n                        console.log(\"删除成功\");\n                    },\n                });\n            });\n            cc.sys.localStorage.setItem(KEY, JSON.stringify({}));\n        } else {\n            cc.sys.localStorage.setItem(KEY, JSON.stringify({}));\n        }\n\n\n    },\n\n});\n"]}