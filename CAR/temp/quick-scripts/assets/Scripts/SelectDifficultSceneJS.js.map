{"version":3,"sources":["SelectDifficultSceneJS.js"],"names":["GameDataManager","require","cc","Class","extends","Component","properties","pageNum","stageDataArr","curPos","Vec2","difficultTitle","Sprite","pageTeample","default","type","Prefab","contextPageView","PageView","audioControl","onLoad","find","getComponent","content","console","log","initStageData","maxPackageCount","getInstance","getPackageCount","i","passCount","getMaxUnlockedStage","stageCount","getStageCount","stageData","addSubPage","addPage","_createPage","page","instantiate","position","v2","PACKAGE_IMAGE","data","imageViewPath","CompletionLabel","id","getResName","clickEventHandler","EventHandler","target","node","component","handler","customEventData","button","getComponentInChildren","Button","clickEvents","push","init","start","x","getSelectLevelPos","setContentPosition","scheduleOnce","pagePos","getLatestPackage","scrollToPage","enterGameStageCallback","event","playClick","packages","savePageviewPos","director","loadScene","curPage","getCurrentPageIndex","getContentPosition","saveSelectLevelPos","back_btnClick"],"mappings":";;;;;;AAAA,IAAIA,kBAAkBC,QAAQ,mBAAR,CAAtB;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,iBAAS,CADD;AAERC,sBAAc,EAFN;;AAIRC,gBAAQP,GAAGQ,IAJH;AAKRC,wBAAgBT,GAAGU,MALX;AAMRC,qBAAa;AACTC,qBAAS,IADA;AAETC,kBAAMb,GAAGc;AAFA,SANL;AAURC,yBAAiBf,GAAGgB,QAVZ;AAWRC,sBACA;AACIL,qBAAS;AADb;AAZQ,KAHP;;AAoBL;;AAEAM,UAtBK,oBAsBI;AACL,aAAKD,YAAL,GAAoBjB,GAAGmB,IAAH,CAAQ,kBAAR,EAA4BC,YAA5B,CAAyC,oBAAzC,CAApB;AACA,aAAKC,OAAL,GAAerB,GAAGmB,IAAH,CAAQ,uCAAR,CAAf;AACAG,gBAAQC,GAAR,CAAY,KAAZ,EAAmB,KAAKF,OAAxB;AACA,aAAKG,aAAL;AAEH,KA5BI;;AA6BLA,mBAAe,yBAAY;AACvB,YAAIC,kBAAkB3B,gBAAgB4B,WAAhB,GAA8BC,eAA9B,EAAtB,CADuB,CAC+C;AACtE,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,eAApB,EAAqCG,GAArC,EAA0C;AACtC,gBAAIC,YAAY/B,gBAAgB4B,WAAhB,GAA8BI,mBAA9B,CAAkDF,CAAlD,CAAhB;AACA,gBAAIG,aAAajC,gBAAgB4B,WAAhB,GAA8BM,aAA9B,CAA4CJ,CAA5C,CAAjB;;AAEA,gBAAIK,YAAY,EAAEJ,WAAW,CAAb,EAAgBE,YAAY,CAA5B,EAAhB;AACAE,sBAAUJ,SAAV,GAAsBA,SAAtB;AACAI,sBAAUF,UAAV,GAAuBA,UAAvB;AACA,iBAAKzB,YAAL,CAAkBsB,CAAlB,IAAuBK,SAAvB;AACH;AACD,aAAK,IAAIL,KAAI,CAAb,EAAgBA,KAAIH,eAApB,EAAqCG,IAArC,EAA0C;AACtC,iBAAKM,UAAL;AACH;AACJ,KA3CI;AA4CLA,gBAAY,sBAAY;AACpB,aAAKnB,eAAL,CAAqBoB,OAArB,CAA6B,KAAKC,WAAL,EAA7B;AACH,KA9CI;AA+CLA,eA/CK,yBA+CS;;AAEV,YAAIC,OAAOrC,GAAGsC,WAAH,CAAe,KAAK3B,WAApB,CAAX;AACA0B,aAAKE,QAAL,GAAgB,IAAIvC,GAAGwC,EAAP,CAAU,CAAV,EAAa,CAAb,CAAhB;AACA,YAAIC,gBAAgB,CAAC,cAAD,EAAiB,gBAAjB,EAAmC,cAAnC,EAAmD,gBAAnD,CAApB;AACA,YAAIb,IAAI,KAAKvB,OAAb;AACA,YAAIqC,OAAO,EAAEC,eAAe,EAAjB,EAAqBC,iBAAiB,EAAtC,EAA0CC,IAAI,CAA9C,EAAX;AACAH,aAAKC,aAAL,GAAqB7C,gBAAgB4B,WAAhB,GAA8BoB,UAA9B,CAAyCL,cAAcb,CAAd,CAAzC,CAArB;AACAc,aAAKE,eAAL,GAAuB,KAAKtC,YAAL,CAAkBsB,CAAlB,EAAqBC,SAArB,GAAiC,GAAjC,GAAuC,KAAKvB,YAAL,CAAkBsB,CAAlB,EAAqBG,UAAnF;AACA,YAAIgB,oBAAoB,IAAI/C,GAAGG,SAAH,CAAa6C,YAAjB,EAAxB;AACAD,0BAAkBE,MAAlB,GAA2B,KAAKC,IAAhC;AACAH,0BAAkBI,SAAlB,GAA8B,wBAA9B;AACAJ,0BAAkBK,OAAlB,GAA4B,wBAA5B;AACAL,0BAAkBM,eAAlB,GAAoC,KAAKhD,OAAzC;AACA,YAAIiD,SAASjB,KAAKkB,sBAAL,CAA4BvD,GAAGwD,MAA/B,CAAb;AACAF,eAAOG,WAAP,CAAmBC,IAAnB,CAAwBX,iBAAxB;AACAV,aAAKjB,YAAL,CAAkB,wBAAlB,EAA4CuC,IAA5C,CAAiDjB,IAAjD;AACA,UAAE,KAAKrC,OAAP;AACA,eAAOgC,IAAP;AACH,KAlEI;AAoELuB,SApEK,mBAoEG;AACR,aAAKrD,MAAL,GAAc,IAAIP,GAAGQ,IAAP,CAAY,CAAZ,EAAe,CAAf,CAAd;AACI,aAAKD,MAAL,CAAYsD,CAAZ,GAAgB/D,gBAAgB4B,WAAhB,GAA8BoC,iBAA9B,EAAhB;AACA,YAAI,KAAKvD,MAAL,CAAYsD,CAAZ,IAAiB,CAArB,EAAwB;AACpB,iBAAKtD,MAAL,CAAYsD,CAAZ,GAAgB,CAAC,KAAjB;AACH;AACD,aAAK9C,eAAL,CAAqBgD,kBAArB,CAAwC,KAAKxD,MAA7C,EANI,CAMiD;;AAErD,aAAKyD,YAAL,CAAkB,YAAY;;AAE1B,gBAAIC,UAAUnE,gBAAgB4B,WAAhB,GAA8BwC,gBAA9B,EAAd;AACA,iBAAKnD,eAAL,CAAqBoD,YAArB,CAAkCF,OAAlC;AAEH,SALD,EAKG,IALH;AAMH,KAlFI;;;AAoFLG,4BAAwB,gCAAUC,KAAV,EAAiBhB,eAAjB,EAAkC;AACtD,aAAKiB,SAAL;AACA,YAAIpB,OAAOmB,MAAMpB,MAAjB;AACA,YAAIK,SAASJ,KAAK9B,YAAL,CAAkBpB,GAAGwD,MAArB,CAAb;AACA,YAAIe,WAAWlB,eAAf;AACA,aAAKiB,SAAL;AACA,aAAKE,eAAL;AACAxE,WAAGyE,QAAH,CAAYC,SAAZ,CAAsB,kBAAtB;AACH,KA5FI;AA6FL;AACAF,qBAAiB,2BAAY;AACzB,YAAIG,UAAU,KAAK5D,eAAL,CAAqB6D,mBAArB,EAAd;AACA,aAAKrE,MAAL,GAAc,KAAKQ,eAAL,CAAqB8D,kBAArB,EAAd;AACA/E,wBAAgB4B,WAAhB,GAA8BoD,kBAA9B,CAAiD,KAAKvE,MAAL,CAAYsD,CAA7D;AACH,KAlGI;AAmGL;AACAkB,iBApGK,2BAoGW;AACZ,aAAKT,SAAL;AACA,aAAKE,eAAL;AACAxE,WAAGyE,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH,KAxGI;;AAyGLJ,eAAW,qBAAY;AACnB,YAAI,KAAKrD,YAAT,EAAuB;AACnB,iBAAKA,YAAL,CAAkBqD,SAAlB;AACH;AACJ;AA7GI,CAAT","file":"SelectDifficultSceneJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        pageNum: 0,\n        stageDataArr: [],\n\n        curPos: cc.Vec2,\n        difficultTitle: cc.Sprite,\n        pageTeample: {\n            default: null,\n            type: cc.Prefab,\n        },\n        contextPageView: cc.PageView,\n        audioControl:\n        {\n            default: null,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        this.content = cc.find('Canvas/DifficultPageView/view/content')\n        console.log(\"找到了\", this.content);\n        this.initStageData();\n\n    },\n    initStageData: function () {\n        let maxPackageCount = GameDataManager.getInstance().getPackageCount();//传入4\n        for (let i = 0; i < maxPackageCount; i++) {\n            let passCount = GameDataManager.getInstance().getMaxUnlockedStage(i);\n            let stageCount = GameDataManager.getInstance().getStageCount(i);\n\n            let stageData = { passCount: 0, stageCount: 0 };\n            stageData.passCount = passCount;\n            stageData.stageCount = stageCount;\n            this.stageDataArr[i] = stageData;\n        }\n        for (let i = 0; i < maxPackageCount; i++) {\n            this.addSubPage();\n        }\n    },\n    addSubPage: function () {\n        this.contextPageView.addPage(this._createPage());\n    },\n    _createPage() {\n\n        var page = cc.instantiate(this.pageTeample);\n        page.position = new cc.v2(0, 0);\n        let PACKAGE_IMAGE = [\"package_easy\", \"package_medium\", \"package_hard\", \"package_expert\"];\n        let i = this.pageNum;\n        let data = { imageViewPath: \"\", CompletionLabel: \"\", id: 0 };\n        data.imageViewPath = GameDataManager.getInstance().getResName(PACKAGE_IMAGE[i]);\n        data.CompletionLabel = this.stageDataArr[i].passCount + \"/\" + this.stageDataArr[i].stageCount;\n        var clickEventHandler = new cc.Component.EventHandler();\n        clickEventHandler.target = this.node;\n        clickEventHandler.component = \"SelectDifficultSceneJS\";\n        clickEventHandler.handler = \"enterGameStageCallback\";\n        clickEventHandler.customEventData = this.pageNum;\n        var button = page.getComponentInChildren(cc.Button);\n        button.clickEvents.push(clickEventHandler);\n        page.getComponent('subDifficultTemplateJS').init(data);\n        ++this.pageNum;\n        return page;\n    },\n\n    start() {\n    this.curPos = new cc.Vec2(0, 0);\n        this.curPos.x = GameDataManager.getInstance().getSelectLevelPos();\n        if (this.curPos.x >= 0) {\n            this.curPos.x = -375.0;\n        }\n        this.contextPageView.setContentPosition(this.curPos);//设置当前视图内容的坐标点\n\n        this.scheduleOnce(function () {\n\n            var pagePos = GameDataManager.getInstance().getLatestPackage();\n            this.contextPageView.scrollToPage(pagePos);\n\n        }, 0.01);\n    },\n\n    enterGameStageCallback: function (event, customEventData) {\n        this.playClick();\n        var node = event.target;\n        var button = node.getComponent(cc.Button);\n        let packages = customEventData;\n        this.playClick();\n        this.savePageviewPos();\n        cc.director.loadScene(\"ChooseStageScene\");\n    },\n    //记录package，LevelPos\n    savePageviewPos: function () {\n        let curPage = this.contextPageView.getCurrentPageIndex();\n        this.curPos = this.contextPageView.getContentPosition();\n        GameDataManager.getInstance().saveSelectLevelPos(this.curPos.x);\n    },\n    // update (dt) {},\n    back_btnClick() {\n        this.playClick();\n        this.savePageviewPos();\n        cc.director.loadScene(\"main\");\n    },\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n});\n"]}