{"version":3,"sources":["SelectDifficultSceneJS.js"],"names":["GameDataManager","require","cc","Class","extends","Component","properties","pageNum","stageDataArr","curPos","Vec2","choosestage","Node","count","default","type","select","onLoad","can","find","getComponent","Canvas","winSize","width","height","designScreen","fitHeight","fitWidth","alignWithScreen","audioControl","content","console","log","initStageData","i","clickEventHandler","EventHandler","target","node","component","handler","customEventData","button","Button","clickEvents","push","sys","isNative","platform","IPHONE","size","view","getFrameSize","isIphoneX","cvs","self","maxPackageCount","getInstance","getPackageCount","passCount","getMaxUnlockedStage","stageCount","getStageCount","stageData","Label","string","addSubPage","contextPageView","addPage","_createPage","page","instantiate","pageTeample","position","v2","PACKAGE_IMAGE","data","imageViewPath","CompletionLabel","id","getResName","getComponentInChildren","init","start","enterGameStageCallback","event","saveLatestPackage","removeAllChildren","playClick","packages","active","ChooseStageJS","savePageviewPos","saveSelectLevelPos","x","back_btnClick","director","loadScene"],"mappings":"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","file":"SelectDifficultSceneJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        pageNum: 0,\n        stageDataArr: [],\n\n        curPos: cc.Vec2,\n        // difficultTitle: cc.Sprite,\n        // pageTeample: {\n        //     default: null,\n        //     type: cc.Prefab,\n        // },\n        // contextPageView: cc.PageView,\n        // audioControl:\n        // {\n        //     default: null,\n        // },\n        choosestage:cc.Node,\n        count:{\n            default: [],\n            type: [cc.Node],\n        },\n        select:{\n            default: [],\n            type: [cc.Node],\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        let can = cc.find(\"Canvas\").getComponent(cc.Canvas);\n        cc.winSize.width / cc.winSize.height <= (750 / 1334).designScreen ? (can.fitHeight = false, can.fitWidth = true) : (can.fitHeight = true, can.fitWidth = false);\n        can.alignWithScreen();\n        this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        this.content = cc.find('Canvas/DifficultPageView/view/content')\n        console.log(\"找到了\", this.content);\n        this.initStageData();\n        for(var i=0;i<4;i++){\n        var clickEventHandler = new cc.Component.EventHandler();\n        clickEventHandler.target = this.node;\n        clickEventHandler.component = \"SelectDifficultSceneJS\";\n        clickEventHandler.handler = \"enterGameStageCallback\";\n        clickEventHandler.customEventData = i;\n        var button = this.select[i].getComponent(cc.Button);\n        button.clickEvents.push(clickEventHandler);\n         //iPhoneX适配\n         if(cc.sys.isNative && cc.sys.platform == cc.sys.IPHONE){\n            var size = cc.view.getFrameSize();\n            var isIphoneX = (size.width == 2436 && size.height == 1125) \n                   ||(size.width == 1125 && size.height == 2436);\n            if(isIphoneX){\n                var cvs = this.node.getComponent(cc.Canvas);\n                cvs.fitHeight = true;\n                cvs.fitWidth = true;\n            }\n         }\n  }\n    },\n    initStageData: function () {\n        var self=this;\n        let maxPackageCount = GameDataManager.getInstance().getPackageCount();//传入4\n        for (let i = 0; i < maxPackageCount; i++) {\n            let passCount = GameDataManager.getInstance().getMaxUnlockedStage(i);\n            let stageCount = GameDataManager.getInstance().getStageCount(i);\n\n            let stageData = { passCount: 0, stageCount: 0 };\n            stageData.passCount = passCount;\n            stageData.stageCount = stageCount;\n            this.stageDataArr[i] = stageData;\n            self.count[i].getComponent(cc.Label).string=stageData.passCount +\"/\"+stageData.stageCount;\n        }\n        \n        // for (let i = 0; i < maxPackageCount; i++) {\n        //     this.addSubPage();\n        // }\n    },\n    addSubPage: function () {\n        this.contextPageView.addPage(this._createPage());\n    },\n    _createPage() {\n\n        var page = cc.instantiate(this.pageTeample);\n        page.position = new cc.v2(0, 0);\n        let PACKAGE_IMAGE = [\"package_easy\", \"package_medium\", \"package_hard\", \"package_expert\"];\n        let i = this.pageNum;\n        let data = { imageViewPath: \"\", CompletionLabel: \"\", id: 0 };\n        data.imageViewPath = GameDataManager.getInstance().getResName(PACKAGE_IMAGE[i]);\n        data.CompletionLabel = this.stageDataArr[i].passCount + \"/\" + this.stageDataArr[i].stageCount;\n        var clickEventHandler = new cc.Component.EventHandler();\n        clickEventHandler.target = this.node;\n        clickEventHandler.component = \"SelectDifficultSceneJS\";\n        clickEventHandler.handler = \"enterGameStageCallback\";\n        clickEventHandler.customEventData = this.pageNum;\n        var button = page.getComponentInChildren(cc.Button);\n        button.clickEvents.push(clickEventHandler);\n        page.getComponent('subDifficultTemplateJS').init(data);\n        ++this.pageNum;\n        return page;\n    },\n\n    start() {\n    // this.curPos = new cc.Vec2(0, 0);\n    //     this.curPos.x = GameDataManager.getInstance().getSelectLevelPos();\n    //     if (this.curPos.x >= 0) {\n    //         this.curPos.x = -375.0;\n    //     }\n    //     this.contextPageView.setContentPosition(this.curPos);//设置当前视图内容的坐标点\n\n    //     this.scheduleOnce(function () {\n\n    //         var pagePos = GameDataManager.getInstance().getLatestPackage();\n    //         this.contextPageView.scrollToPage(pagePos);\n\n    //     }, 0.01);\n    },\n\n    enterGameStageCallback: function (event, customEventData) {\n        GameDataManager.getInstance().saveLatestPackage(customEventData);\n        var choosestage=cc.find(\"Canvas/choosestage/stageScrollView/view/content\")\n        choosestage.removeAllChildren();\n        this.playClick();\n        // this.choosestage.active=false;\n        var node = event.target;\n        var button = node.getComponent(cc.Button);\n        let packages = customEventData;\n        this.playClick();\n        // this.savePageviewPos();\n        // cc.director.loadScene(\"ChooseStageScene\");\n        this.choosestage.active=true;\n        var ChooseStageJS=cc.find(\"Canvas/choosestage\").getComponent(\"ChooseStageJS\");\n        ChooseStageJS.init();\n    },\n    //记录package，LevelPos\n    savePageviewPos: function () {\n        // let curPage = this.contextPageView.getCurrentPageIndex();\n        // this.curPos = this.contextPageView.getContentPosition();\n        GameDataManager.getInstance().saveSelectLevelPos(this.curPos.x);\n    },\n    // update (dt) {},\n    back_btnClick() {\n        this.playClick();\n        this.savePageviewPos();\n        cc.director.loadScene(\"main\");\n    },\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n});\n"]}