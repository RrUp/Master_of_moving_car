{"version":3,"sources":["SelectDifficultSceneJS.js"],"names":["GameDataManager","require","cc","Class","extends","Component","properties","pageNum","stageDataArr","curPos","Vec2","choosestage","Node","count","default","type","select","onLoad","audioControl","find","getComponent","content","console","log","initStageData","i","clickEventHandler","EventHandler","target","node","component","handler","customEventData","button","Button","clickEvents","push","self","maxPackageCount","getInstance","getPackageCount","passCount","getMaxUnlockedStage","stageCount","getStageCount","stageData","Label","string","addSubPage","contextPageView","addPage","_createPage","page","instantiate","pageTeample","position","v2","PACKAGE_IMAGE","data","imageViewPath","CompletionLabel","id","getResName","getComponentInChildren","init","start","enterGameStageCallback","event","saveLatestPackage","removeAllChildren","playClick","packages","active","ChooseStageJS","savePageviewPos","saveSelectLevelPos","x","back_btnClick","director","loadScene"],"mappings":"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","file":"SelectDifficultSceneJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        pageNum: 0,\n        stageDataArr: [],\n\n        curPos: cc.Vec2,\n        // difficultTitle: cc.Sprite,\n        // pageTeample: {\n        //     default: null,\n        //     type: cc.Prefab,\n        // },\n        // contextPageView: cc.PageView,\n        // audioControl:\n        // {\n        //     default: null,\n        // },\n        choosestage:cc.Node,\n        count:{\n            default: [],\n            type: [cc.Node],\n        },\n        select:{\n            default: [],\n            type: [cc.Node],\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        this.content = cc.find('Canvas/DifficultPageView/view/content')\n        console.log(\"找到了\", this.content);\n        this.initStageData();\n        for(var i=0;i<4;i++){\n        var clickEventHandler = new cc.Component.EventHandler();\n        clickEventHandler.target = this.node;\n        clickEventHandler.component = \"SelectDifficultSceneJS\";\n        clickEventHandler.handler = \"enterGameStageCallback\";\n        clickEventHandler.customEventData = i;\n        var button = this.select[i].getComponent(cc.Button);\n        button.clickEvents.push(clickEventHandler);\n  }\n    },\n    initStageData: function () {\n        var self=this;\n        let maxPackageCount = GameDataManager.getInstance().getPackageCount();//传入4\n        for (let i = 0; i < maxPackageCount; i++) {\n            let passCount = GameDataManager.getInstance().getMaxUnlockedStage(i);\n            let stageCount = GameDataManager.getInstance().getStageCount(i);\n\n            let stageData = { passCount: 0, stageCount: 0 };\n            stageData.passCount = passCount;\n            stageData.stageCount = stageCount;\n            this.stageDataArr[i] = stageData;\n            self.count[i].getComponent(cc.Label).string=stageData.passCount +\"/\"+stageData.stageCount;\n        }\n        \n        // for (let i = 0; i < maxPackageCount; i++) {\n        //     this.addSubPage();\n        // }\n    },\n    addSubPage: function () {\n        this.contextPageView.addPage(this._createPage());\n    },\n    _createPage() {\n\n        var page = cc.instantiate(this.pageTeample);\n        page.position = new cc.v2(0, 0);\n        let PACKAGE_IMAGE = [\"package_easy\", \"package_medium\", \"package_hard\", \"package_expert\"];\n        let i = this.pageNum;\n        let data = { imageViewPath: \"\", CompletionLabel: \"\", id: 0 };\n        data.imageViewPath = GameDataManager.getInstance().getResName(PACKAGE_IMAGE[i]);\n        data.CompletionLabel = this.stageDataArr[i].passCount + \"/\" + this.stageDataArr[i].stageCount;\n        var clickEventHandler = new cc.Component.EventHandler();\n        clickEventHandler.target = this.node;\n        clickEventHandler.component = \"SelectDifficultSceneJS\";\n        clickEventHandler.handler = \"enterGameStageCallback\";\n        clickEventHandler.customEventData = this.pageNum;\n        var button = page.getComponentInChildren(cc.Button);\n        button.clickEvents.push(clickEventHandler);\n        page.getComponent('subDifficultTemplateJS').init(data);\n        ++this.pageNum;\n        return page;\n    },\n\n    start() {\n    // this.curPos = new cc.Vec2(0, 0);\n    //     this.curPos.x = GameDataManager.getInstance().getSelectLevelPos();\n    //     if (this.curPos.x >= 0) {\n    //         this.curPos.x = -375.0;\n    //     }\n    //     this.contextPageView.setContentPosition(this.curPos);//设置当前视图内容的坐标点\n\n    //     this.scheduleOnce(function () {\n\n    //         var pagePos = GameDataManager.getInstance().getLatestPackage();\n    //         this.contextPageView.scrollToPage(pagePos);\n\n    //     }, 0.01);\n    },\n\n    enterGameStageCallback: function (event, customEventData) {\n        GameDataManager.getInstance().saveLatestPackage(customEventData);\n        var choosestage=cc.find(\"Canvas/choosestage/stageScrollView/view/content\")\n        choosestage.removeAllChildren();\n        this.playClick();\n        cc.log(\"!!!!!\",customEventData)\n        // this.choosestage.active=false;\n        var node = event.target;\n        var button = node.getComponent(cc.Button);\n        let packages = customEventData;\n        this.playClick();\n        // this.savePageviewPos();\n        // cc.director.loadScene(\"ChooseStageScene\");\n        this.choosestage.active=true;\n        var ChooseStageJS=cc.find(\"Canvas/choosestage\").getComponent(\"ChooseStageJS\");\n        ChooseStageJS.init();\n    },\n    //记录package，LevelPos\n    savePageviewPos: function () {\n        // let curPage = this.contextPageView.getCurrentPageIndex();\n        // this.curPos = this.contextPageView.getContentPosition();\n        GameDataManager.getInstance().saveSelectLevelPos(this.curPos.x);\n    },\n    // update (dt) {},\n    back_btnClick() {\n        this.playClick();\n        this.savePageviewPos();\n        cc.director.loadScene(\"main\");\n    },\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n});\n"]}