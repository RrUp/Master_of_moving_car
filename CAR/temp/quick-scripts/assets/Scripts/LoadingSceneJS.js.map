{"version":3,"sources":["LoadingSceneJS.js"],"names":["GameDataManager","require","define","point","isLoading","isAuthorization","cc","Class","extends","Component","properties","wxlog_btn","Node","loadingBar","type","ProgressBar","default","loadinglab","Sprite","loadingpercent","Label","titlebg","audioControl","onLoad","can","find","getComponent","Canvas","winSize","width","height","designScreen","fitHeight","fitWidth","alignWithScreen","CC_WECHATGAME","game","on","sure","console","log","active","node","getInstance","preLoadingdata","getgold","savegold","money","getcarskin","savecarskin","carskin","getInfo","progress","sys","isNative","platform","IPHONE","size","view","getFrameSize","isIphoneX","cvs","Promise","resolve","reject","wx","getSetting","success","res","authSetting","createUserInfoButton","button","text","style","left","top","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","getUserInfo","hide","nickName","userInfo","avatarUrl","emit","fail","authorize","scope","start","director","preloadScene","getVisibleSize","getDesignResolutionSize","DesignResolutionSize","WinSize","nodeX","nodeY","update","dt","updateload","onLoadComplete","string","Math","floor","loadScene"],"mappings":"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","file":"LoadingSceneJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\nvar define = require(\"define\");\nlet point = 0;\nlet isLoading = false;\nlet isAuthorization = false;\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        wxlog_btn: cc.Node,\n        loadingBar: {\n            type: cc.ProgressBar,\n            default: null\n        },\n        loadinglab: cc.Sprite,\n        loadingpercent: cc.Label,\n        titlebg: cc.Sprite,\n        audioControl:\n        {\n            default: null,\n        },\n    },\n    onLoad() {\n        //   cc.sys.localStorage.clear();\n        // GameDataManager.getInstance().adapt(this.node) \n        let can = cc.find(\"Canvas\").getComponent(cc.Canvas);\n        cc.winSize.width / cc.winSize.height <= (750 / 1334).designScreen ? (can.fitHeight = false, can.fitWidth = true) : (can.fitHeight = true, can.fitWidth = false);\n        can.alignWithScreen();\n        if (CC_WECHATGAME) {\n            cc.game.on(\"impower\", (sure) => {\n                if (sure) {\n                    console.log(\"授权成功！\")\n                    isAuthorization = true;\n                    this.wxlog_btn.active = false;\n                    this.loadingBar.node.active = true;\n                    this.loadinglab.node.active = true;\n                    this.loadingpercent.node.active = true;\n\n                    GameDataManager.getInstance().preLoadingdata();\n                    if (!define.getgold()) {\n                        GameDataManager.getInstance().savegold(define.money);\n                        cc.log(\"首次加载游戏获取到当前金币(应为100)\", GameDataManager.getInstance().getgold())\n                    }\n                    if (!define.getcarskin()) {\n                        cc.log(\"第一次保存皮肤\")\n                        GameDataManager.getInstance().savecarskin(define.carskin);\n                         }\n                }\n                else { }\n            })\n            this.getInfo();\n            this.loadingBar.progress = 0;\n            this.loadingBar.node.active = false;\n            this.loadinglab.node.active = false;\n            this.loadingpercent.node.active = false;\n        }\n        else {\n            console.log(\"授权成功！\");\n          \n            isAuthorization = true;\n            this.wxlog_btn.active = false;\n            this.loadingBar.node.active = true;\n            this.loadinglab.node.active = true;\n            this.loadingpercent.node.active = true;\n\n            GameDataManager.getInstance().preLoadingdata();\n            if (!define.getgold()) {\n                GameDataManager.getInstance().savegold(define.money);\n                cc.log(\"首次加载游戏获取到当前金币(应为100)\", GameDataManager.getInstance().getgold())\n            }\n              if (!define.getcarskin()) {\n                    cc.log(\"第一次保存皮肤\")\n                    GameDataManager.getInstance().savecarskin(define.carskin);\n                     }\n        } \n        //iPhoneX适配\n        // console.log(\"-----\",cc.sys.platform)\n        // console.log(\"+++++\",cc.sys.IPHONE)\n        if(cc.sys.isNative && cc.sys.platform == cc.sys.IPHONE){\n            console.log(\"***iPhoneX**\")\n            var size = cc.view.getFrameSize();\n            var isIphoneX = (size.width == 2436 && size.height == 1125) \n                   ||(size.width == 1125 && size.height == 2436);\n            if(isIphoneX){\n                var cvs = this.node.getComponent(cc.Canvas);\n                cvs.fitHeight = true;\n                cvs.fitWidth = true;\n            }\n         }\n     \n    },\n    getInfo() {\n        return new Promise(function (resolve, reject) {\n            if (CC_WECHATGAME) {\n                wx.getSetting({\n                    success(res) {\n                        if (!res.authSetting['scope.userInfo']) {\n                            if (wx.createUserInfoButton) {\n                                let button = wx.createUserInfoButton({\n                                    type: 'text',\n                                    text: '',\n                                    style: {\n                                        left: 0,\n                                        top: 0,\n                                        width: 5000,\n                                        height: 5000,\n                                        lineHeight: 40,\n                                        backgroundColor: '',\n                                        color: '',\n                                        textAlign: 'center',\n                                        fontSize: 40,\n                                        borderRadius: 10\n                                    }\n                                });\n\n                                button.onTap(function () {\n                                    wx.getUserInfo({\n                                        success: function (res) {\n                                            button.hide();\n                                            define.nickName = res.userInfo.nickName;\n                                            define.avatarUrl = res.userInfo.avatarUrl;\n                                            cc.game.emit(\"impower\", true);\n                                            resolve();\n                                        },\n                                        fail: function (res) {\n                                            console.log(res);\n                                            cc.game.emit(\"impower\", false);\n                                            reject();\n                                        }\n                                    });\n                                });\n                            } else {\n                                wx.authorize({\n                                    scope: 'scope.userInfo',\n                                    success() {\n                                        wx.getUserInfo({\n                                            success: function (res) {\n                                                define.nickName = res.userInfo.nickName;\n                                                define.avatarUrl = res.userInfo.avatarUrl;\n                                                resolve();\n                                            },\n                                            fail: function (res) {\n                                                reject();\n                                            }\n                                        })\n                                    }\n                                })\n                            }\n\n                        } else {\n                            wx.getUserInfo({\n                                success: function (res) {\n                                    console.log('res', res);\n                                    define.nickName = res.userInfo.nickName;\n                                    define.avatarUrl = res.userInfo.avatarUrl;\n                                    cc.game.emit(\"impower\", true);\n                                    resolve();\n                                },\n                                fail: function (res) {\n                                    reject();\n                                }\n                            })\n                        }\n                    }\n                })\n            } else {\n                resolve();\n            }\n        })\n    },\n    start() {\n        cc.director.preloadScene(\"main\", cc.log('预加载main'));\n        //适配\n        console.log('    cc.winSize =' + cc.winSize);//以磅为单位返回WebGL视图的大小。它考虑了窗口的任何可能的旋转\n        console.log('    cc.view.getVisibleSize() =' + cc.view.getVisibleSize());//返回正在运行的场景的可见大小\n        console.log('    cc.view.getFrameSize() =' + cc.view.getFrameSize());//返回视图的帧大小。在本机平台上，它返回屏幕大小，因为视图是全屏视图。在Web上，它返回画布外部DOM元素的大小\n        console.log('    cc.view.getDesignResolutionSize() =' + cc.view.getDesignResolutionSize());//返回视图的设计大小。默认分辨率大小与'getFrameSize'相同\n        var DesignResolutionSize = cc.view.getDesignResolutionSize();\n        var WinSize = cc.winSize;\n        var nodeX = WinSize.width / DesignResolutionSize.width;\n        var nodeY = WinSize.height / DesignResolutionSize.height;\n        console.log('    nodeX=   ' + nodeX + '  nodeY=' + nodeY);\n\n    },\n    update(dt) {\n        this.updateload(dt);\n    },\n    updateload(dt){\n        if(isAuthorization){\n        if (this.loadingBar.progress >= 1 && isLoading == false) {\n            isLoading = true;\n            this.onLoadComplete();\n        }\n        point += dt;\n        this.loadingBar.progress = ((point / 3) > 1 ? 1 : point / 3);\n        this.loadingpercent.string = Math.floor(this.loadingBar.progress * 100) + \"%\";\n   } \n},\n    onLoadComplete() {\n        cc.director.loadScene(\"main\");\n    },\n\n\n\n\n});"]}