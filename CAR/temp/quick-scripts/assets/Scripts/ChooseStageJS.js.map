{"version":3,"sources":["ChooseStageJS.js"],"names":["GameDataManager","require","define","cc","Class","extends","Component","properties","m_MaxUnlockedStageIdx","m_StageCount","m_PageCount","m_Package","m_PageStageCount","MaxCustomsPass","m_pageNum","titlePrefab","default","type","Prefab","subStagePrefab","subPackgePrefab","contextScrollView","ScrollView","audioControl","onLoad","find","getComponent","getInstance","getLatestPackage","getMaxUnlockedStage","getStageCount","log","addTitle","addStageBtn","start","newTitle","instantiate","node","addChild","data","TitleLabelStr","TitleLabelId","TitlePos","v2","getTextById","position","init","stageData","stageId","startNum","i","getCompleteStars","newStageBtnItem","content","clickEventHandler","EventHandler","target","component","handler","customEventData","button","Button","clickEvents","push","scrollToPercentVertical","enterGameSceneCallback","event","playClick","console","setGameCurLevelNum","director","loadScene","saveScrollPos","scrollPos","getContentPosition","setStagePageScollPos","_createPage","addSubPage","onBtnBackClicked"],"mappings":"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","file":"ChooseStageJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nvar GameDataManager = require(\"GameDataManagerJS\");\nvar define = require(\"define\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_MaxUnlockedStageIdx: 0,\n        m_StageCount: 0,\n        m_PageCount: 0,\n        m_Package: 0,\n        m_PageStageCount: define.MaxCustomsPass,//100.最大关卡数\n        m_pageNum: 0,\n\n        titlePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        subStagePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        subPackgePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        contextScrollView: {\n            default: null,\n            type: cc.ScrollView\n        },\n\n        // contextPageView: {\n        //     default: null,\n        //     type: cc.PageView\n        // },\n\n        audioControl:\n        {\n            default: null,\n        },\n\n    },\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        // cc.director.preloadScene(\"game\",cc.log('预加载game'));\n        this.m_Package = GameDataManager.getInstance().getLatestPackage();\n        this.m_MaxUnlockedStageIdx = GameDataManager.getInstance().getMaxUnlockedStage(this.m_Package);\n        this.m_StageCount = GameDataManager.getInstance().getStageCount(this.m_Package);\n        //    this.m_StageCount =50;\n        cc.log(\"this.m_Package \", this.m_Package)\n        this.m_PageCount = (this.m_StageCount / this.m_PageStageCount);\n\n        cc.log(\" this.m_PageCount \", this.m_PageCount)\n\n        this.addTitle();\n        //   this.addSubPage();\n\n        this.addStageBtn();\n    },\n\n    start() {\n        // var scrollPos = GameDataManager.getInstance().getStagePageScollPos()\n        // var norPos = new cc.Vec2(0, 0)\n        // if (scrollPos.equals(norPos)) {\n        //     this.contextScrollView.scrollToPercentVertical(1, 0.01);\n        // } else {\n        //     this.contextScrollView.setContentPosition(scrollPos)\n        // }\n        // GameDataManager.getInstance().getPassTime();\n    },\n    //加title图片\n    addTitle: function () {\n        // 使用给定的模板在场景中生成一个新节点\n        var newTitle = cc.instantiate(this.titlePrefab);\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(newTitle);\n\n        let data = { TitleLabelStr: \"\", TitleLabelId: 0, TitlePos: cc.v2 };\n        data.TitleLabelStr = GameDataManager.getInstance().getTextById(7 + GameDataManager.getInstance().getLatestPackage());\n        data.TitleLabelId = GameDataManager.getInstance().getLatestPackage();\n        // 设置位置\n        // var width = cc.winSize.width;\n        // var height = cc.winSize.height;\n        // var visibleRect = cc.view.getVisibleSize();\n        // var kWH = visibleRect.width / visibleRect.height;\n        // var kMoveHight = (kWH - 750 / 1334)\n        // console.log(\"  k= \" + 750 / 1334 + \" kWH= \" + kWH);\n        // if (kMoveHight > 0) {\n\n        //     data.TitlePos = cc.v2(width * 0.5, height * 0.9);\n        // } else {\n        //     var offset = height * 0.5 * (-kMoveHight)\n        //     data.TitlePos = cc.v2(width * 0.5, height * 0.9 - offset);\n        // }\n        data.TitlePos = cc.v2(0, 500)\n        cc.log(\"title坐标\", data.TitlePos)\n        cc.log(\"位置\", newTitle.position)\n        newTitle.getComponent('subDifficultTitleJS').init(data)//传入title图片\n    },\n    //加入关卡btn\n    addStageBtn: function () {\n        let stageData = { stageId: 0, startNum: 0 };\n\n        for (var i = 0; i < this.m_StageCount; ++i) {\n            stageData.stageId = i;\n            stageData.startNum = GameDataManager.getInstance().getCompleteStars(this.m_Package, i);\n\n            if (this.m_MaxUnlockedStageIdx == i) {\n                stageData.startNum = 0;\n            }\n\n            var newStageBtnItem = cc.instantiate(this.subStagePrefab);\n            this.contextScrollView.content.addChild(newStageBtnItem);\n            \n            newStageBtnItem.getComponent('subStarTemplateJS').init(stageData)//传入关卡id、图片\n            var clickEventHandler = new cc.Component.EventHandler();\n            clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n            clickEventHandler.component = \"ChooseStageJS\";//这个是代码文件名\n            clickEventHandler.handler = \"enterGameSceneCallback\";\n            clickEventHandler.customEventData = stageData.stageId;\n            var button = newStageBtnItem.getComponent(cc.Button);//getComponentInChildren\n            button.clickEvents.push(clickEventHandler);\n\n        }\n        // this.contextScrollView.scrollToTop(0.1);\n        this.contextScrollView.scrollToPercentVertical(1, 0.1);\n        //视图内容在规定时间内滚动到 ScrollView 垂直方向的百分比位置上\n    },\n    enterGameSceneCallback: function (event, customEventData) {\n        //这里 event 是一个 Touch Event 对象，你可以通过 event.target 取到事件的发送节点\n        this.playClick();\n        var node = event.target;\n        var button = node.getComponent(cc.Button);\n        let stageId = customEventData;\n\n        if (stageId <= this.m_MaxUnlockedStageIdx) {\n            console.log(' enterGameSceneCallback  unlcok =', stageId);\n\n            this.playClick();\n            //        this.saveScrollPos();\n            GameDataManager.getInstance().setGameCurLevelNum(stageId);\n            cc.director.loadScene(\"game\");\n           \n        } else {\n            console.log(' enterGameSceneCallback lock =', stageId);\n        }\n        \n    },\n    // addscrollViewEvent: function () {\n\n    //     var scrollViewEventHandler = new cc.Component.EventHandler();\n    //     scrollViewEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n    //     scrollViewEventHandler.component = \"ChooseStageJS\";//这个是代码文件名\n    //     scrollViewEventHandler.handler = \"scrollViewEventCallback\";\n    //     //scrollViewEventHandler.customEventData = \"foobar\";\n\n    //     this.contextScrollView.scrollEvents.push(scrollViewEventHandler);\n    // },\n\n    // scrollViewEventCallback: function (scrollview, eventType, customEventData) {\n    //     //这里 scrollview 是一个 Scrollview 组件对象实例\n    //     //这里的 eventType === cc.ScrollView.EventType enum 里面的值\n    //     //这里的 customEventData 参数就等于你之前设置的 \"foobar\"\n    //     if (define.DEBUG_MODE && define.DEBUG_SCROLL_POS) {\n    //         // var pos = scrollview.getContentPosition();\n    //         // var off = scrollview.getScrollOffset();\n    //         // var maxoff = scrollview.getMaxScrollOffset();\n    //     }\n    // },\n\n    saveScrollPos: function () {\n        var scrollPos = this.contextScrollView.getContentPosition()\n        GameDataManager.getInstance().setStagePageScollPos(scrollPos)\n    },\n\n    _createPage() {\n        // var page = cc.instantiate(this.subPackgePrefab);//layout预制体\n\n        // page.position = new cc.v2(0, 0);\n        // let pagePos = this.m_pageNum;//初始0，结束一次++\n\n        // let stageData = { stageId: 0, startNum: 0 };\n\n        // for (var i = this.m_PageStageCount * pagePos; i < this.m_PageStageCount * (pagePos + 1); ++i) {\n\n        //     stageData.stageId = i;\n\n        //     stageData.startNum = GameDataManager.getInstance().getCompleteStars(this.m_Package, i);\n\n        //     if (this.m_MaxUnlockedStageIdx == i) {\n        //         stageData.startNum = 0;\n        //     }\n        //     console.log('  stage id =' + stageData.stageId + ', num=' + stageData.startNum);\n\n        //     var newStageBtnItem = cc.instantiate(this.subStagePrefab);\n\n        //     newStageBtnItem.getComponent('subStarTemplateJS').init(stageData)\n\n        //     var clickEventHandler = new cc.Component.EventHandler();\n        //     clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n        //     clickEventHandler.component = \"ChooseStageRJS\";//这个是代码文件名\n        //     clickEventHandler.handler = \"enterGameSceneCallback\";\n        //     clickEventHandler.customEventData = stageData.stageId;\n\n        //     var button = newStageBtnItem.getComponent(cc.Button);//getComponentInChildren\n        //     button.clickEvents.push(clickEventHandler);\n\n\n        //     page.addChild(newStageBtnItem);\n        // }\n        // // layout.updateLayout();\n\n        // ++this.m_pageNum;\n        // return page;\n    },\n\n    addSubPage: function () {\n\n        // // for (var i = 0; i < (this.m_PageCount); ++i) {\n        // this.contextPageView.addPage(this._createPage());\n        // // }\n        // console.log(' addSubPage  id =', this.m_pageNum);\n\n        // var allPage = this.contextPageView.getPages()\n    },\n\n\n\n    onBtnBackClicked: function () {\n        console.log('onBtnBackClicked clicked!');\n        this.playClick();\n        //    this.saveScrollPos();\n        cc.director.loadScene(\"SelectDifficultScene\");\n    },\n\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n    // update (dt) {},\n});\n"]}