{"version":3,"sources":["ChooseStageJS.js"],"names":["GameDataManager","require","define","cc","Class","extends","Component","properties","m_MaxUnlockedStageIdx","m_StageCount","m_PageCount","m_Package","m_PageStageCount","MaxCustomsPass","subStagePrefab","default","type","Prefab","subPackgePrefab","contextScrollView","ScrollView","audioControl","onLoad","init","getInstance","getLatestPackage","getMaxUnlockedStage","getStageCount","addStageBtn","start","stageData","stageId","startNum","i","getCompleteStars","newStageBtnItem","instantiate","content","addChild","getComponent","clickEventHandler","EventHandler","target","node","component","handler","customEventData","button","Button","clickEvents","push","scrollToPercentVertical","enterGameSceneCallback","event","playClick","console","log","setGameCurLevelNum","director","loadScene","saveScrollPos","scrollPos","getContentPosition","setStagePageScollPos","_createPage","addSubPage","onBtnBackClicked"],"mappings":"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","file":"ChooseStageJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\nvar define = require(\"define\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_MaxUnlockedStageIdx: 0,\n        m_StageCount: 0,\n        m_PageCount: 0,\n        m_Package: 0,\n        m_PageStageCount: define.MaxCustomsPass,\n\n        // titlePrefab: {\n        //     default: null,\n        //     type: cc.Prefab\n        // },\n        subStagePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        subPackgePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        contextScrollView: {\n            default: null,\n            type: cc.ScrollView\n        },\n        audioControl:\n        {\n            default: null,\n        },\n\n    },\n\n    onLoad() {\n        this.init();\n        // this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        // this.m_Package = GameDataManager.getInstance().getLatestPackage();\n        // this.m_MaxUnlockedStageIdx = GameDataManager.getInstance().getMaxUnlockedStage(this.m_Package);\n        // this.m_StageCount = GameDataManager.getInstance().getStageCount(this.m_Package);\n        // this.m_PageCount = (this.m_StageCount / this.m_PageStageCount);\n        // // this.addTitle();\n        // this.addStageBtn();\n    },\n    init() {\n        this.m_Package = GameDataManager.getInstance().getLatestPackage();\n        this.m_MaxUnlockedStageIdx = GameDataManager.getInstance().getMaxUnlockedStage(this.m_Package);\n        this.m_StageCount = GameDataManager.getInstance().getStageCount(this.m_Package);\n        this.m_PageCount = (this.m_StageCount / this.m_PageStageCount);\n        // this.addTitle();\n        this.addStageBtn();\n    },\n    start() {\n    },\n    // addTitle: function () {\n    //     var newTitle = cc.instantiate(this.titlePrefab);\n    //     this.node.addChild(newTitle);\n    //     let data = { TitleLabelStr: \"\", TitleLabelId: 0, TitlePos: cc.v2 };\n    //     data.TitleLabelStr = GameDataManager.getInstance().getTextById(7 + GameDataManager.getInstance().getLatestPackage());\n    //     data.TitleLabelId = GameDataManager.getInstance().getLatestPackage();\n    //     data.TitlePos = cc.v2(0, 500)\n    //     newTitle.getComponent('subDifficultTitleJS').init(data)\n    // },\n    addStageBtn: function () {\n        let stageData = { stageId: 0, startNum: 0 };\n\n        for (var i = 0; i < this.m_StageCount; ++i) {\n            stageData.stageId = i;\n            stageData.startNum = GameDataManager.getInstance().getCompleteStars(this.m_Package, i);\n\n            if (this.m_MaxUnlockedStageIdx == i) {\n                stageData.startNum = 0;\n            }\n\n            var newStageBtnItem = cc.instantiate(this.subStagePrefab);\n            this.contextScrollView.content.addChild(newStageBtnItem);\n\n            newStageBtnItem.getComponent('subStarTemplateJS').init(stageData)//传入关卡id、图片\n            var clickEventHandler = new cc.Component.EventHandler();\n            clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n            clickEventHandler.component = \"ChooseStageJS\";//这个是代码文件名\n            clickEventHandler.handler = \"enterGameSceneCallback\";\n            clickEventHandler.customEventData = stageData.stageId;\n            var button = newStageBtnItem.getComponent(cc.Button);//getComponentInChildren\n            button.clickEvents.push(clickEventHandler);\n\n        }\n        // this.contextScrollView.scrollToTop(0.1);\n        this.contextScrollView.scrollToPercentVertical(1, 0.1);\n        //视图内容在规定时间内滚动到 ScrollView 垂直方向的百分比位置上\n    },\n    enterGameSceneCallback: function (event, customEventData) {\n        //这里 event 是一个 Touch Event 对象，你可以通过 event.target 取到事件的发送节点\n        this.playClick();\n        var node = event.target;\n        var button = node.getComponent(cc.Button);\n        let stageId = customEventData;\n\n        if (stageId <= this.m_MaxUnlockedStageIdx) {\n            console.log(' enterGameSceneCallback  unlcok =', stageId);\n\n            this.playClick();\n            //        this.saveScrollPos();\n            GameDataManager.getInstance().setGameCurLevelNum(stageId);\n            cc.director.loadScene(\"game\");\n\n        } else {\n            console.log(' enterGameSceneCallback lock =', stageId);\n        }\n\n    },\n    // addscrollViewEvent: function () {\n\n    //     var scrollViewEventHandler = new cc.Component.EventHandler();\n    //     scrollViewEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n    //     scrollViewEventHandler.component = \"ChooseStageJS\";//这个是代码文件名\n    //     scrollViewEventHandler.handler = \"scrollViewEventCallback\";\n    //     //scrollViewEventHandler.customEventData = \"foobar\";\n\n    //     this.contextScrollView.scrollEvents.push(scrollViewEventHandler);\n    // },\n\n    // scrollViewEventCallback: function (scrollview, eventType, customEventData) {\n    //     //这里 scrollview 是一个 Scrollview 组件对象实例\n    //     //这里的 eventType === cc.ScrollView.EventType enum 里面的值\n    //     //这里的 customEventData 参数就等于你之前设置的 \"foobar\"\n    //     if (define.DEBUG_MODE && define.DEBUG_SCROLL_POS) {\n    //         // var pos = scrollview.getContentPosition();\n    //         // var off = scrollview.getScrollOffset();\n    //         // var maxoff = scrollview.getMaxScrollOffset();\n    //     }\n    // },\n\n    saveScrollPos: function () {\n        var scrollPos = this.contextScrollView.getContentPosition()\n        GameDataManager.getInstance().setStagePageScollPos(scrollPos)\n    },\n\n    _createPage() {\n        // var page = cc.instantiate(this.subPackgePrefab);//layout预制体\n\n        // page.position = new cc.v2(0, 0);\n        // let pagePos = this.m_pageNum;//初始0，结束一次++\n\n        // let stageData = { stageId: 0, startNum: 0 };\n\n        // for (var i = this.m_PageStageCount * pagePos; i < this.m_PageStageCount * (pagePos + 1); ++i) {\n\n        //     stageData.stageId = i;\n\n        //     stageData.startNum = GameDataManager.getInstance().getCompleteStars(this.m_Package, i);\n\n        //     if (this.m_MaxUnlockedStageIdx == i) {\n        //         stageData.startNum = 0;\n        //     }\n        //     console.log('  stage id =' + stageData.stageId + ', num=' + stageData.startNum);\n\n        //     var newStageBtnItem = cc.instantiate(this.subStagePrefab);\n\n        //     newStageBtnItem.getComponent('subStarTemplateJS').init(stageData)\n\n        //     var clickEventHandler = new cc.Component.EventHandler();\n        //     clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n        //     clickEventHandler.component = \"ChooseStageRJS\";//这个是代码文件名\n        //     clickEventHandler.handler = \"enterGameSceneCallback\";\n        //     clickEventHandler.customEventData = stageData.stageId;\n\n        //     var button = newStageBtnItem.getComponent(cc.Button);//getComponentInChildren\n        //     button.clickEvents.push(clickEventHandler);\n\n\n        //     page.addChild(newStageBtnItem);\n        // }\n        // // layout.updateLayout();\n\n        // ++this.m_pageNum;\n        // return page;\n    },\n\n    addSubPage: function () {\n\n        // // for (var i = 0; i < (this.m_PageCount); ++i) {\n        // this.contextPageView.addPage(this._createPage());\n        // // }\n        // console.log(' addSubPage  id =', this.m_pageNum);\n\n        // var allPage = this.contextPageView.getPages()\n    },\n\n\n\n    onBtnBackClicked: function () {\n        console.log('onBtnBackClicked clicked!');\n        this.playClick();\n        //    this.saveScrollPos();\n        cc.director.loadScene(\"SelectDifficultScene\");\n    },\n\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n    // update (dt) {},\n});\n"]}