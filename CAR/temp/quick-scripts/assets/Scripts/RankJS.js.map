{"version":3,"sources":["RankJS.js"],"names":["define","require","AdsManager","GameDataManager","cc","Class","extends","Component","name","properties","groupFriendButton","Button","rankingScrollView","Sprite","mainNode","Node","onLoad","start","friendButtonFunc","event","CC_WECHATGAME","window","wx","postMessage","messageType","MAIN_MENU_NUM","RankKey","log","groupFriendButtonFunc","titleText","shareAppMessage","title","imageUrl","success","res","shareTickets","undefined","length","shareTicket","console","gameOverButtonFunc","submitScoreButtonFunc","goals","getInstance","getGoals","score","update","dt","_updateSubDomainCanvas","tex","sharedCanvas","getOpenDataContext","openDataContext","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame"],"mappings":"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","file":"RankJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var define = require(\"define\");\nvar AdsManager = require(\"AdsManagerJS\");\nvar GameDataManager = require(\"GameDataManagerJS\");\ncc.Class({\n    extends: cc.Component,\n    name: \"RankJS\",\n    properties: {\n        groupFriendButton: cc.Button,\n        // friendButton: cc.Node,\n        rankingScrollView: cc.Sprite,//显示排行榜\n        mainNode: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        // var self = this;\n        // var canvas = self.mainNode\n        // canvas.on(cc.Node.EventType.TOUCH_START, function (event) {\n        //     event.stopPropagation();\n        // }, self.node);\n        // canvas.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n        //     event.stopPropagation();\n        // }, self.node);\n        // canvas.on(cc.Node.EventType.TOUCH_END, function (event) {\n        //     event.stopPropagation();\n        // }, self.node);\n        // this.friendButtonFunc();\n    },\n\n    start() {\n        // if (CC_WECHATGAME) {\n        //     window.wx.showShareMenu({ withShareTicket: true });//设置分享按钮，方便获取群id展示群排行榜\n        //     this.tex = new cc.Texture2D();\n        //     console.log(\"rankingScrollView setContentSize \" + cc.director.getVisibleSize());\n        //     var k = 0.5;\n        //     //    this.rankingScrollView.node.setContentSize(cc.director.getVisibleSize());\n        //     // window.wx.postMessage({\n        //     //     messageType: 1,\n        //     //     MAIN_MENU_NUM: define.RankKey\n        //     // });\n        // }\n        // this.groupFriendButton.getComponentInChildren(cc.Label).string = '群排行'\n        // cc.log(\"+========\", this.groupFriendButton.getComponentInChildren(cc.Label).string)\n        //GameDataManager.getInstance().getTextById(14);\n    },\n    friendButtonFunc(event) {\n        if (CC_WECHATGAME) {\n            // 发消息给子域\n            window.wx.postMessage({\n                messageType: 1,\n                MAIN_MENU_NUM: define.RankKey\n            });\n        } else {\n            cc.log(\"获取好友排行榜数据。define.RankKey\");\n        }\n        // console.log(\" show 好友排行榜数据 \");\n        // AdsManager.getInstance().hideBannerAD();\n        // if (CC_WECHATGAME) {\n        //     if (window.wx.postMessage&&wx.getOpenDataContext) {\n        //         this.mainNode.active = true;\n        //         // 发消息给子域\n        //         window.wx.postMessage({\n        //             messageType: 1,\n        //             MAIN_MENU_NUM: define.RankKey\n        //         });\n        //     } else {\n        //         wx.showModal({\n        //             title: '提示',\n        //             content: '当前微信版本过低，好友排行榜，无法使用该功能，请升级到最新微信版本后重试。'\n        //         });\n        //     }\n\n        // } else {\n        //     console.log(\"不支持 获取好友排行榜数据。define.RankKey\");\n        // }\n    },\n\n    groupFriendButtonFunc: function (event) {\n        if (CC_WECHATGAME) {\n            var titleText = '90后女司机诚邀您决战秋名山'\n            window.wx.shareAppMessage({\n                title: titleText,\n                imageUrl: \"res/raw-assets/resources/share/sharePic4.jpg\",\n                success: (res) => {\n                    if (res.shareTickets != undefined && res.shareTickets.length > 0) {\n                        window.wx.postMessage({\n                            messageType: 5,\n                            MAIN_MENU_NUM: define.RankKey,\n                            shareTicket: res.shareTickets[0]\n                        });\n                    }\n                }\n            });\n        } else {\n            console.log(\"不支持 获取群排行榜数据。define.RankKey\");\n        }\n    },\n\n    gameOverButtonFunc: function (event) {\n        if (CC_WECHATGAME) {\n            window.wx.postMessage({// 发消息给子域\n                messageType: 4,\n                MAIN_MENU_NUM: define.RankKey\n            });\n        } else {\n            console.log(\"获取横向展示排行榜数据。define.RankKey\");\n        }\n    },\n\n    submitScoreButtonFunc() {\n       let goals = GameDataManager.getInstance().getGoals();\n        console.log(\"得分 : \" + goals)\n        if (CC_WECHATGAME) {\n            window.wx.postMessage({\n                messageType: 3,\n                MAIN_MENU_NUM: define.RankKey,\n                score: goals,\n            });\n        } else {\n            console.log(\"fail 提交得分 : \" + goals)\n        }\n    },\n    update(dt) {\n        this._updateSubDomainCanvas();\n    },\n    // 刷新子域的纹理\n    _updateSubDomainCanvas() {\n        if (!this.tex) {\n            return;\n        }\n        if (window.sharedCanvas != undefined) {\n            if (wx.getOpenDataContext) {\n                var openDataContext = wx.getOpenDataContext();\n                var sharedCanvas = openDataContext.canvas;\n                this.tex.initWithElement(sharedCanvas);\n                this.tex.handleLoadedTexture();\n                this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\n            }\n        }\n\n        // if (window.sharedCanvas != undefined) {\n        //     this.tex.initWithElement(window.sharedCanvas);\n        //     this.tex.handleLoadedTexture();\n        //     this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\n        // }\n    },\n});\n"]}