{"version":3,"sources":["WeChatFileSystemManager.js"],"names":["module","exports","init","urlRoot","gameName","fileSystemManager","wx","getFileSystemManager","rootPath","env","USER_DATA_PATH","console","log","getFileName","url","relativePath","substring","indexOf","length","k","directory","file","getFile","data","fileName","path","self","stat","success","res","stats","isDirectory","isFile","fail","err","downloadFile","saveFile","tempFilePath","filePath","res1","removeFile","unlink","showFile","readdir","dirPath"],"mappings":"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","file":"WeChatFileSystemManager.js","sourceRoot":"../../../../../../../assets/wechat_game_module-master/exp/GameBox/Script","sourcesContent":["\nmodule.exports = {\n    //初始化文件系统\n    init: function (urlRoot,gameName) {\n        this.fileSystemManager = wx.getFileSystemManager();\n        //微信本地用户文件目录\n        this.rootPath = `${wx.env.USER_DATA_PATH}`;\n        //\b相对的URL的目录，为之后通过 URL 找到文件做准备\n        this.urlRoot = urlRoot;\n        this.gameName = gameName;\n        console.log(this.gameName);\n    },\n\n    //通过 URL 转换到文件名 支持多级目录\n    // 例如：   URL    = https://www.7cgames.cn/GameRes/7CGamesBoxWX/NewGameBox/QR/dtds-wx87fb6c7ae9ec4923-1.jpg\n    // 转换成： 文件名  = NewGameBox-QR-dtds-wx87fb6c7ae9ec4923-1.jpg \n    getFileName: function (url) {\n        // console.log(url);\n\n        //找到符合的位置\n        var relativePath = url.substring(url.indexOf(this.urlRoot), url.length);\n\n        //把 ‘/’ 替换成 ‘-’\n        while (relativePath.indexOf(\"/\") != -1) {\n            var k = relativePath.indexOf(\"/\");\n            var directory = relativePath.substring(0, k);\n            var file = relativePath.substring(k + 1, relativePath.length);\n            relativePath = directory + '-' + file;\n        }\n\n        // console.log(relativePath);\n\n        return relativePath;\n    },\n\n    //得到文件\n    getFile: function (data) {\n        //拿到本地用户目录下的文件\n        var fileName = this.getFileName(data.url);\n        var path = this.rootPath + \"/\" + fileName;\n        var self = this;\n\n        //是否存在   存在是文件还是目录(目录是多于的判断，但是可以避免\b错误的url)\n        this.fileSystemManager.stat({\n            path: path,\n            success: function (res) {\n                if (res.stats.isDirectory()) {\n                    // console.log(\"这是目录\");\n                }\n                if (res.stats.isFile()) {\n                    console.log(\"这是文件： \" +fileName);\n                    data.success(path);\n                }\n            },\n            fail: function (err) {\n                //文件不存在 \b我们就下载\n                // console.log(err);\n                console.log(fileName + \"文件不存在，下载\");\n                console.log(data.url + \"?\" + self.gameName);\n                wx.downloadFile({\n                    url: data.url + \"?\" + self.gameName,\n                    success: function (res) {\n                        //下载成功\n                        // console.log(res);\n                        console.log(\"下载成功\");\n\n                        wx.saveFile({\n                            tempFilePath: res.tempFilePath,\n                            filePath: path,\n                            success: function (res1) {\n                                // console.log(res1);\n                                console.log(\"保存到本地\");\n\n                                data.success(path);\n                            },\n                            fail: function (err) {\n                                console.log(err);\n                                data.fail();\n                            }\n                        })\n                    },\n                    fail: function (err) {\n                        console.log(err);\n                        data.fail();\n                    }\n                });\n            },\n        });\n    },\n\n    //删除文件\n    removeFile: function (data) {\n        var fileName = this.getFileName(data.url);\n        var path = this.rootPath + \"/\" + fileName;\n        var self = this;\n        this.fileSystemManager.stat({\n            path: path,\n            success: function (res) {\n                self.fileSystemManager.unlink({\n                    filePath: path,\n                    success: function () {\n                        data.success();\n                    },\n                    fail: function (err) {\n                        console.log(err);\n                    },\n                });\n            },\n            fail: function (err) {\n                // console.log(err);\n                console.log(\"本地不存在\");\n                data.success();\n            },\n        });\n    },\n\n    showFile: function () {\n        this.fileSystemManager.readdir({\n            dirPath: `${wx.env.USER_DATA_PATH}`,\n            success: function (res) {\n                console.log(res);\n            },\n            fail: function () {\n\n            },\n        });\n    }\n\n}"]}