{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/ChooseStageJS.js"],"names":["GameDataManager","require","define","cc","Class","extends","Component","properties","m_MaxUnlockedStageIdx","m_StageCount","m_PageCount","m_Package","m_PageStageCount","MaxCustomsPass","titlePrefab","default","type","Prefab","subStagePrefab","subPackgePrefab","contextScrollView","ScrollView","audioControl","onLoad","find","getComponent","getInstance","getLatestPackage","getMaxUnlockedStage","getStageCount","addTitle","addStageBtn","start","newTitle","instantiate","node","addChild","data","TitleLabelStr","TitleLabelId","TitlePos","v2","getTextById","init","stageData","stageId","startNum","i","getCompleteStars","newStageBtnItem","content","clickEventHandler","EventHandler","target","component","handler","customEventData","button","Button","clickEvents","push","scrollToPercentVertical","enterGameSceneCallback","event","playClick","setGameCurLevelNum","director","loadScene","saveScrollPos","scrollPos","getContentPosition","setStagePageScollPos","onBtnBackClicked"],"mappings":"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","file":"ChooseStageJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\nvar define = require(\"define\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_MaxUnlockedStageIdx: 0,\n        m_StageCount: 0,\n        m_PageCount: 0,\n        m_Package: 0,\n        m_PageStageCount: define.MaxCustomsPass,\n\n        titlePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        subStagePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        subPackgePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        contextScrollView: {\n            default: null,\n            type: cc.ScrollView\n        },\n        audioControl:\n        {\n            default: null,\n        },\n\n    },\n\n    onLoad() {\n        this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        this.m_Package = GameDataManager.getInstance().getLatestPackage();\n        this.m_MaxUnlockedStageIdx = GameDataManager.getInstance().getMaxUnlockedStage(this.m_Package);\n        this.m_StageCount = GameDataManager.getInstance().getStageCount(this.m_Package);\n        this.m_PageCount = (this.m_StageCount / this.m_PageStageCount);\n        this.addTitle();\n        this.addStageBtn();\n    },\n\n    start() {\n    },\n    addTitle: function () {\n        var newTitle = cc.instantiate(this.titlePrefab);\n        this.node.addChild(newTitle);\n        let data = { TitleLabelStr: \"\", TitleLabelId: 0, TitlePos: cc.v2 };\n        data.TitleLabelStr = GameDataManager.getInstance().getTextById(7 + GameDataManager.getInstance().getLatestPackage());\n        data.TitleLabelId = GameDataManager.getInstance().getLatestPackage();\n        data.TitlePos = cc.v2(0, 500)\n        newTitle.getComponent('subDifficultTitleJS').init(data)\n    },\n    addStageBtn: function () {\n        let stageData = { stageId: 0, startNum: 0 };\n        for (var i = 0; i < this.m_StageCount; ++i) {\n            stageData.stageId = i;\n            stageData.startNum = GameDataManager.getInstance().getCompleteStars(this.m_Package, i);\n            if (this.m_MaxUnlockedStageIdx == i) {\n                stageData.startNum = 0;\n            }\n            var newStageBtnItem = cc.instantiate(this.subStagePrefab);\n            this.contextScrollView.content.addChild(newStageBtnItem);\n            \n            newStageBtnItem.getComponent('subStarTemplateJS').init(stageData)\n            var clickEventHandler = new cc.Component.EventHandler();\n            clickEventHandler.target = this.node; \n            clickEventHandler.component = \"ChooseStageJS\";\n            clickEventHandler.handler = \"enterGameSceneCallback\";\n            clickEventHandler.customEventData = stageData.stageId;\n            var button = newStageBtnItem.getComponent(cc.Button);\n            button.clickEvents.push(clickEventHandler);\n\n        }\n        this.contextScrollView.scrollToPercentVertical(1, 0.1);\n    },\n    enterGameSceneCallback: function (event, customEventData) {\n        this.playClick();\n        var node = event.target;\n        var button = node.getComponent(cc.Button);\n        let stageId = customEventData;\n        if (stageId <= this.m_MaxUnlockedStageIdx) {\n            this.playClick();\n            GameDataManager.getInstance().setGameCurLevelNum(stageId);\n            cc.director.loadScene(\"game\");\n           \n        } else {\n        }\n    },\n \n    saveScrollPos: function () {\n        var scrollPos = this.contextScrollView.getContentPosition()\n        GameDataManager.getInstance().setStagePageScollPos(scrollPos)\n    },\n\n    onBtnBackClicked: function () {\n        this.playClick();\n        cc.director.loadScene(\"SelectDifficultScene\");\n    },\n\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n    // update (dt) {},\n});\n"]}