{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/ChooseStageJS.js"],"names":["GameDataManager","require","define","cc","Class","extends","Component","properties","m_MaxUnlockedStageIdx","m_StageCount","m_PageCount","m_Package","m_PageStageCount","MaxCustomsPass","subStagePrefab","default","type","Prefab","subPackgePrefab","contextScrollView","ScrollView","audioControl","onLoad","can","find","getComponent","Canvas","winSize","width","height","designScreen","fitHeight","fitWidth","alignWithScreen","init","getInstance","getLatestPackage","getMaxUnlockedStage","getStageCount","addStageBtn","start","stageData","stageId","startNum","i","getCompleteStars","newStageBtnItem","instantiate","content","addChild","clickEventHandler","EventHandler","target","node","component","handler","customEventData","button","Button","clickEvents","push","scrollToPercentVertical","enterGameSceneCallback","event","playClick","console","log","setGameCurLevelNum","director","loadScene","saveScrollPos","scrollPos","getContentPosition","setStagePageScollPos","_createPage","addSubPage"],"mappings":"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","file":"ChooseStageJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\nvar define = require(\"define\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_MaxUnlockedStageIdx: 0,\n        m_StageCount: 0,\n        m_PageCount: 0,\n        m_Package: 0,\n        m_PageStageCount: define.MaxCustomsPass,\n\n        // titlePrefab: {\n        //     default: null,\n        //     type: cc.Prefab\n        // },\n        subStagePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        subPackgePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        contextScrollView: {\n            default: null,\n            type: cc.ScrollView\n        },\n        audioControl:\n        {\n            default: null,\n        },\n\n    },\n\n    onLoad() {\n        let can = cc.find(\"Canvas\").getComponent(cc.Canvas);\n    cc.winSize.width / cc.winSize.height <= (750 / 1334).designScreen ? (can.fitHeight = false, can.fitWidth = true) : (can.fitHeight = true, can.fitWidth = false);\n    can.alignWithScreen();\n        this.init();\n        this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        \n        // this.m_Package = GameDataManager.getInstance().getLatestPackage();\n        // this.m_MaxUnlockedStageIdx = GameDataManager.getInstance().getMaxUnlockedStage(this.m_Package);\n        // this.m_StageCount = GameDataManager.getInstance().getStageCount(this.m_Package);\n        // this.m_PageCount = (this.m_StageCount / this.m_PageStageCount);\n        // // this.addTitle();\n        // this.addStageBtn();\n    },\n    init() {\n        this.m_Package = GameDataManager.getInstance().getLatestPackage();\n        this.m_MaxUnlockedStageIdx = GameDataManager.getInstance().getMaxUnlockedStage(this.m_Package);\n        this.m_StageCount = GameDataManager.getInstance().getStageCount(this.m_Package);\n        this.m_PageCount = (this.m_StageCount / this.m_PageStageCount);\n        // this.addTitle();\n        this.addStageBtn();\n    },\n    start() {\n    },\n    // addTitle: function () {\n    //     var newTitle = cc.instantiate(this.titlePrefab);\n    //     this.node.addChild(newTitle);\n    //     let data = { TitleLabelStr: \"\", TitleLabelId: 0, TitlePos: cc.v2 };\n    //     data.TitleLabelStr = GameDataManager.getInstance().getTextById(7 + GameDataManager.getInstance().getLatestPackage());\n    //     data.TitleLabelId = GameDataManager.getInstance().getLatestPackage();\n    //     data.TitlePos = cc.v2(0, 500)\n    //     newTitle.getComponent('subDifficultTitleJS').init(data)\n    // },\n    addStageBtn: function () {\n        let stageData = { stageId: 0, startNum: 0 };\n\n        for (var i = 0; i < this.m_StageCount; ++i) {\n            stageData.stageId = i;\n            stageData.startNum = GameDataManager.getInstance().getCompleteStars(this.m_Package, i);\n\n            if (this.m_MaxUnlockedStageIdx == i) {\n                stageData.startNum = 0;\n            }\n\n            var newStageBtnItem = cc.instantiate(this.subStagePrefab);\n            this.contextScrollView.content.addChild(newStageBtnItem);\n\n            newStageBtnItem.getComponent('subStarTemplateJS').init(stageData)//传入关卡id、图片\n            var clickEventHandler = new cc.Component.EventHandler();\n            clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n            clickEventHandler.component = \"ChooseStageJS\";//这个是代码文件名\n            clickEventHandler.handler = \"enterGameSceneCallback\";\n            clickEventHandler.customEventData = stageData.stageId;\n            var button = newStageBtnItem.getComponent(cc.Button);//getComponentInChildren\n            button.clickEvents.push(clickEventHandler);\n\n        }\n        // this.contextScrollView.scrollToTop(0.1);\n        this.contextScrollView.scrollToPercentVertical(1, 0.1);\n        //视图内容在规定时间内滚动到 ScrollView 垂直方向的百分比位置上\n    },\n    enterGameSceneCallback: function (event, customEventData) {\n        //这里 event 是一个 Touch Event 对象，你可以通过 event.target 取到事件的发送节点\n        this.playClick();\n        var node = event.target;\n        var button = node.getComponent(cc.Button);\n        let stageId = customEventData;\n\n        if (stageId <= this.m_MaxUnlockedStageIdx) {\n            console.log(' enterGameSceneCallback  unlcok =', stageId);\n\n            this.playClick();\n            //        this.saveScrollPos();\n            GameDataManager.getInstance().setGameCurLevelNum(stageId);\n            cc.director.loadScene(\"game\");\n\n        } else {\n            console.log(' enterGameSceneCallback lock =', stageId);\n        }\n\n    },\n    // addscrollViewEvent: function () {\n\n    //     var scrollViewEventHandler = new cc.Component.EventHandler();\n    //     scrollViewEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n    //     scrollViewEventHandler.component = \"ChooseStageJS\";//这个是代码文件名\n    //     scrollViewEventHandler.handler = \"scrollViewEventCallback\";\n    //     //scrollViewEventHandler.customEventData = \"foobar\";\n\n    //     this.contextScrollView.scrollEvents.push(scrollViewEventHandler);\n    // },\n\n    // scrollViewEventCallback: function (scrollview, eventType, customEventData) {\n    //     //这里 scrollview 是一个 Scrollview 组件对象实例\n    //     //这里的 eventType === cc.ScrollView.EventType enum 里面的值\n    //     //这里的 customEventData 参数就等于你之前设置的 \"foobar\"\n    //     if (define.DEBUG_MODE && define.DEBUG_SCROLL_POS) {\n    //         // var pos = scrollview.getContentPosition();\n    //         // var off = scrollview.getScrollOffset();\n    //         // var maxoff = scrollview.getMaxScrollOffset();\n    //     }\n    // },\n\n    saveScrollPos: function () {\n        var scrollPos = this.contextScrollView.getContentPosition()\n        GameDataManager.getInstance().setStagePageScollPos(scrollPos)\n    },\n\n    _createPage() {\n        // var page = cc.instantiate(this.subPackgePrefab);//layout预制体\n\n        // page.position = new cc.v2(0, 0);\n        // let pagePos = this.m_pageNum;//初始0，结束一次++\n\n        // let stageData = { stageId: 0, startNum: 0 };\n\n        // for (var i = this.m_PageStageCount * pagePos; i < this.m_PageStageCount * (pagePos + 1); ++i) {\n\n        //     stageData.stageId = i;\n\n        //     stageData.startNum = GameDataManager.getInstance().getCompleteStars(this.m_Package, i);\n\n        //     if (this.m_MaxUnlockedStageIdx == i) {\n        //         stageData.startNum = 0;\n        //     }\n        //     console.log('  stage id =' + stageData.stageId + ', num=' + stageData.startNum);\n\n        //     var newStageBtnItem = cc.instantiate(this.subStagePrefab);\n\n        //     newStageBtnItem.getComponent('subStarTemplateJS').init(stageData)\n\n        //     var clickEventHandler = new cc.Component.EventHandler();\n        //     clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n        //     clickEventHandler.component = \"ChooseStageRJS\";//这个是代码文件名\n        //     clickEventHandler.handler = \"enterGameSceneCallback\";\n        //     clickEventHandler.customEventData = stageData.stageId;\n\n        //     var button = newStageBtnItem.getComponent(cc.Button);//getComponentInChildren\n        //     button.clickEvents.push(clickEventHandler);\n\n\n        //     page.addChild(newStageBtnItem);\n        // }\n        // // layout.updateLayout();\n\n        // ++this.m_pageNum;\n        // return page;\n    },\n\n    addSubPage: function () {\n\n        // // for (var i = 0; i < (this.m_PageCount); ++i) {\n        // this.contextPageView.addPage(this._createPage());\n        // // }\n        // console.log(' addSubPage  id =', this.m_pageNum);\n\n        // var allPage = this.contextPageView.getPages()\n    },\n\n\n\n    // onBtnBackClicked: function () {\n    //     console.log('onBtnBackClicked clicked!');\n    //     this.playClick();\n    //     //    this.saveScrollPos();\n    //     cc.director.loadScene(\"SelectDifficultScene\");\n    // },\n\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n    // update (dt) {},\n});\n"]}