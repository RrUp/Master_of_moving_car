{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/BlockJS.js"],"names":["define","require","MyLayoutManager","TILES","Block","cc","Class","extends","Component","properties","m_Tile","m_Orientation","m_Length","m_Id","Vec2","kBlockState_Ungrabbed","statics","s_CurrentTouchedBlock","getCurrentTouchedBlock","clearCurrentTouchedBlock","ctor","m_GPosition","getGPosition","getLastGPosition","m_LastGPosition","getTouchBeganGPosition","m_TouchBeganGPos","getTouchBeganPosition","m_TouchBeganPos","getOrientation","getLength","init","data","initWithOrientationAndLength","orientation","length","panda","kOrientation_Horizontal","buf","carskin","urlPath","url","raw","sp","getComponent","Sprite","self","loader","loadRes","SpriteFrame","err","spriteFrame","vecZERO","node","setAnchorPoint","len","getInstance","getGridSize","width","m_Scale","height","setScale","getPosition","newPos","carSprite","getAbsolutePosition","blockPos","visibleSize","view","getVisibleSize","origin","getVisibleOrigin","gameLayout","find","gameLayoutPos","absoluPos","x","y","setPosition","pos","DEBUG_MODE","DEBUG_SHOW_POS","console","log","setGPosition","gpos","getContentSize","getScaleY","getScaleX","setId","id","getId","onLoad","add_touch_listeners","start","setOnBlockListener","listener","m_OnBlockListener","canvas","on","Node","EventType","TOUCH_START","event","pblock","m_State","onDragged","kBlockState_Grabbed","tempPos","parseInt","TOUCH_MOVE","onMove","TOUCH_END","onDrop","TOUCH_CANCEL","module","exports"],"mappings":"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","file":"BlockJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nvar define = require(\"define\");\nvar MyLayoutManager = require(\"MyLayoutManagerJS\");\n\nvar TILES = [[\"car0_0-\", \"car0_1-\", \"car1\", \"car0_2-\", \"car0_3-\"],\n[\"car1_0-\", \"car1_1-\", \"car2\", \"car1_2-\", \"car1_3-\"],\n[\"car2_0-\", \"car2_1-\", \"car3\", \"car2_2-\", \"car2_3-\"],\n[\"car3_0-\", \"car3_1-\", \"car4\", \"car3_2-\", \"car3_3-\"],\n[\"car2_0-\", \"car2_1-\", \"car5\", \"car2_2-\", \"car2_3-\"],\n[\"car2_0-\", \"car2_1-\", \"car6\", \"car2_2-\", \"car2_3-\"],];\n\n\nvar Block = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        m_Tile: 0,\n        m_Orientation: 0,\n        m_Length: 2,\n        m_Id: 0,\n        m_Orientation: 0,\n\n        m_TouchBeganPos: cc.Vec2,\n        m_TouchBeganGPos: cc.Vec2,\n        m_GPosition: cc.Vec2,\n        m_LastGPosition: cc.Vec2,\n\n        m_Scale: cc.Vec2,\n\n        m_State: define.kBlockState_Ungrabbed,\n    },\n\n    statics: {\n        s_CurrentTouchedBlock: null,\n\n        getCurrentTouchedBlock: function () {\n            return this.s_CurrentTouchedBlock;\n        },\n\n        clearCurrentTouchedBlock: function () {\n            this.s_CurrentTouchedBlock = null;\n        },\n    },\n    ctor: function () {\n        this.m_GPosition = new cc.Vec2(-1, -1);\n    },\n\n    //new 防止成员变量在其他外部被更改 有可能有内存问题\n    getGPosition: function () {\n        return new cc.Vec2(this.m_GPosition);\n    },\n    getLastGPosition: function () {\n        return new cc.Vec2(this.m_LastGPosition);\n    },\n    getTouchBeganGPosition: function () {\n        return new cc.Vec2(this.m_TouchBeganGPos);\n    },\n    getTouchBeganPosition: function () {\n        return new cc.Vec2(this.m_TouchBeganPos);\n    },\n    getOrientation: function () {\n        return this.m_Orientation;\n    },\n\n    getLength: function () {\n        return this.m_Length;\n    },\n\n    init: function (data) {\n\n        this.m_GPosition = new cc.Vec2(-1, -1);\n\n        this.initWithOrientationAndLength(data.orientation, data.length, data.panda);\n\n    },\n\n    initWithOrientationAndLength: function (orientation, length, panda) {\n        if (orientation == define.kOrientation_Horizontal) {\n            this.m_Tile = (length == 2 ? (panda ? 2 : 0) : (length == 3 ? 3 : -1));\n        }\n        else\n            this.m_Tile = (length == 2 ? (panda ? -1 : 1) : (length == 3 ? 4 : -1));\n        //相应图片\n\n        var buf;\n        if (this.m_Tile == 2) {\n            buf = TILES[define.carskin-1][this.m_Tile] + \"\";\n        } else {\n            buf = TILES[0][this.m_Tile] + \"0\";\n        }\n\n        if (this.m_Tile >= 0) {\n            var urlPath = cc.url.raw(\"resources/\" + buf);\n            var sp = this.getComponent(cc.Sprite);\n            //sp.spriteFrame = new cc.SpriteFrame(urlPath);\n\n            var self = this;\n            urlPath =( buf);\n            cc.loader.loadRes(urlPath, cc.SpriteFrame, function (err, spriteFrame) {\n                sp.spriteFrame = spriteFrame;\n            });\n\n            this.m_Orientation = orientation;\n            this.m_Length = length;\n\n            var vecZERO = new cc.Vec2(0, 0)\n            sp.node.setAnchorPoint(vecZERO);\n            var len = MyLayoutManager.getInstance().getGridSize().width / (71 + 0);\n            this.m_Scale = new cc.Vec2(MyLayoutManager.getInstance().getGridSize().width / (91 + 0), MyLayoutManager.getInstance().getGridSize().height / (91 + 0));\n            sp.node.setScale(this.m_Scale);\n\n            return true;\n        }\n        return false;\n    },\n\n    getPosition: function () {\n        //返回在gameLayout中的相对坐标\n        var newPos = new cc.Vec2;\n        var carSprite = this.getComponent(cc.Sprite);\n        newPos = carSprite.node.getPosition();\n        return newPos;\n    },\n\n    getAbsolutePosition: function () {\n        //返回在 屏幕中的绝对坐标\n        var blockPos = new cc.Vec2;\n        var carSprite = this.getComponent(cc.Sprite);\n        blockPos = carSprite.node.getPosition();\n\n        var visibleSize = cc.view.getVisibleSize();\n        var origin = cc.view.getVisibleOrigin();\n\n        var gameLayout = cc.find(\"Canvas/gameplay/gameCenterNode\");\n        var gameLayoutPos = new cc.Vec2(gameLayout.getPosition());\n\n        var absoluPos = new cc.Vec2;\n        absoluPos.x = gameLayoutPos.x + (visibleSize.width + origin.x) / 2\n        absoluPos.y = gameLayoutPos.y + (visibleSize.height + origin.y) / 2\n\n        var newPos = new cc.Vec2;\n\n        newPos.x = absoluPos.x + blockPos.x\n        newPos.y = absoluPos.y + blockPos.y\n\n        return newPos;\n    },\n\n    setPosition: function (pos) {\n        //pos 是在屏幕上的绝对坐标 换算成在gameLayout中的相对坐标再设置位置\n        var visibleSize = cc.view.getVisibleSize();\n        var origin = cc.view.getVisibleOrigin();\n        var newPos = new cc.Vec2;\n        var gameLayout = cc.find(\"Canvas/gameplay/gameCenterNode\");\n        var gameLayoutPos = new cc.Vec2(gameLayout.getPosition());\n\n        newPos.x = gameLayoutPos.x + (visibleSize.width + origin.x) / 2\n        newPos.y = gameLayoutPos.y + (visibleSize.height + origin.y) / 2\n\n        newPos.x = pos.x - newPos.x;\n        newPos.y = pos.y - newPos.y;\n\n        var carSprite = this.getComponent(cc.Sprite);\n        carSprite.node.setPosition(newPos);\n\n        if (define.DEBUG_MODE && define.DEBUG_SHOW_POS) {\n            console.log('car setPosition= ' + pos + ',相对Pos=' + newPos);\n        }\n    },\n\n    setGPosition: function (gpos) {\n        this.m_LastGPosition = this.m_GPosition;\n        this.m_GPosition = gpos;\n    },\n\n    getContentSize: function () {\n        var carSprite = this.getComponent(cc.Sprite);\n        return carSprite.node.getContentSize();\n    },\n\n    getScaleY: function () {\n        return this.m_Scale.y\n    },\n\n    getScaleX: function () {\n        return this.m_Scale.x\n    },\n\n    setId: function (id) {\n        this.m_Id = id;\n    },\n\n    getId: function () {\n        return this.m_Id;\n    },\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.add_touch_listeners();\n    },\n\n    start() {\n\n    },\n\n    // update (dt) {},\n    setOnBlockListener: function (listener) {\n        this.m_OnBlockListener = listener;\n    },\n\n    add_touch_listeners: function () {\n        var carSprite = this.getComponent(cc.Sprite);\n        var self = this;\n        var canvas = carSprite.node // cc.find(\"Canvas\");\n        //canvas.on(cc.Node.EventType.TOUCH_START, this.touch_begin() ,self.node);\n\n        canvas.on(cc.Node.EventType.TOUCH_START, function (event) {\n\n            if (Block.s_CurrentTouchedBlock)\n                return false;\n            var pblock = this.getComponent('BlockJS');\n            if (pblock.m_State != define.kBlockState_Ungrabbed)\n                return false;\n\n            Block.s_CurrentTouchedBlock = pblock;\n\n            if (pblock.m_OnBlockListener) {\n                if (pblock.m_OnBlockListener.onDragged(pblock, event)) {\n                    pblock.m_State = define.kBlockState_Grabbed;\n                    pblock.m_TouchBeganPos = pblock.getAbsolutePosition();\n                    pblock.m_TouchBeganGPos = pblock.m_LastGPosition;\n\n                    if (define.DEBUG_MODE && define.DEBUG_SHOW_POS) {\n                        var tempPos = pblock.getAbsolutePosition();\n                        console.log(\"  car \" + pblock.getId() + \" AbsolutePosition=\" + parseInt(tempPos.x) + \",\" + parseInt(tempPos.y));\n                    }\n                }\n            }\n            else {\n                pblock.m_State = define.kBlockState_Grabbed;\n                pblock.m_TouchBeganPos = pblock.getAbsolutePosition();\n\n                if (define.DEBUG_MODE && define.DEBUG_SHOW_POS) {\n                    var tempPos = pblock.getAbsolutePosition();\n                    console.log(\"  car \" + pblock.getId() + \" AbsolutePosition=\" + parseInt(tempPos.x) + \",\" + parseInt(tempPos.y));\n                }\n            }\n        }, self.node);\n\n        canvas.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n            var pblock = this.getComponent('BlockJS');\n\n            if (Block.s_CurrentTouchedBlock != pblock)\n                return;\n\n            if (pblock.m_State == define.kBlockState_Grabbed) {\n                if (pblock.m_OnBlockListener) {\n                    pblock.m_OnBlockListener.onMove(pblock, event);\n                }\n            }\n        }, self.node);\n\n        canvas.on(cc.Node.EventType.TOUCH_END, function (event) {\n            var pblock = this.getComponent('BlockJS');\n\n            if (Block.s_CurrentTouchedBlock != pblock)\n                return;\n\n            if (pblock.m_State == define.kBlockState_Grabbed) {\n                pblock.m_State = define.kBlockState_Ungrabbed;\n\n                if (pblock.m_OnBlockListener) {\n                    pblock.m_OnBlockListener.onDrop(pblock, event);\n                }\n            }\n            Block.s_CurrentTouchedBlock = null;\n        }, self.node);\n\n        canvas.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\n            var pblock = this.getComponent('BlockJS');\n\n            if (Block.s_CurrentTouchedBlock != pblock)\n                return;\n\n            if (pblock.m_State == define.kBlockState_Grabbed) {\n                pblock.m_State = define.kBlockState_Ungrabbed;\n\n                if (pblock.m_OnBlockListener) {\n                    pblock.m_OnBlockListener.onDrop(pblock, event);\n                }\n            }\n\n            Block.s_CurrentTouchedBlock = null;\n        }, self.node);\n    },\n\n});\nmodule.exports = Block;\n"]}