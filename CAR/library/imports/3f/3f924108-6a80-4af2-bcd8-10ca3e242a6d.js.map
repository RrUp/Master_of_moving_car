{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/ShareManagerJS.js"],"names":["ShareManager","cc","Class","extends","Component","properties","head_url","nick_name","id","info","statics","_instance","show_count","getInstance","ctor","init","start","FBInstant","player","getName","getID","getPhoto","contextID","context","contextType","getType","locale","getLocale","platform","getPlatform","sdkVersion","getSDKVersion","CC_WECHATGAME","onShareGame","textstring","titleText","pic_url","length","shareAsync","intent","image","getImgBase64","text","data","myReplayData","then","console","log","pic_list","i","push","text_list","indexOf","wx","shareAppMessage","title","imageUrl","success","res","fail","target","find","width","height","renderTexture","RenderTexture","begin","_sgNode","visit","end","canvas","document","createElement","ctx","getContext","_renderType","game","RENDER_TYPE_CANVAS","texture","getSprite","getTexture","getHtmlElementObj","drawImage","RENDER_TYPE_WEBGL","buffer","gl","createFramebuffer","bindFramebuffer","FRAMEBUFFER","_glID","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","rowBytes","row","srow","data2","Uint8ClampedArray","imageData","ImageData","putImageData","toDataURL","NavigateTo7cGameBox","navigateToMiniProgram","appId","path","showModal","content","module","exports"],"mappings":"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","file":"ShareManagerJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var ShareManager = cc.Class({\n\n    extends: cc.Component,\n    properties: {\n        // avatar: cc.Sprite,      // 头像\n        // nick_name: cc.Label,    // 昵称\n        // id: cc.Label,           // ID\n        // info: cc.Label          // 其他信息\n        head_url: '',      // 头像\n        nick_name: '',    // 昵称\n        id: 0,           // ID\n        info: ''          // 其他信息\n    },\n    statics: {\n        _instance: null,\n        show_count: 0,\n        getInstance: function () {\n            if (ShareManager._instance === null) {\n                this._instance = new ShareManager();\n            }\n            return ShareManager._instance;\n        }\n    },\n    ctor: function () {\n        this.init()\n\n    },\n    // LIFE-CYCLE CALLBACKS:\n    // onLoad () {},\n\n    start() {\n\n        {\n            // if (typeof FBInstant === 'undefined') return;\n            //     // 显示玩家信息\n            //     // 设置昵称\n            //     this.nick_name.string = 'Name:' + FBInstant.player.getName();\n            //     // 设置 ID\n            //     this.id.string = 'ID:' + FBInstant.player.getID();\n            //     // 设置头像\n            //     var photoUrl = FBInstant.player.getPhoto();\n            //     cc.loader.load(photoUrl, (err, texture) => {\n            //         this.avatar.spriteFrame = new cc.SpriteFrame(texture);\n            //     });\n            //     // 设置其他信息\n            //     var info = {\n            //         contextID: FBInstant.context.getID(), // 游戏 ID\n            //         contextType: FBInstant.context.getType(), // 游戏类型\n            //         locale: FBInstant.getLocale(),  // 地区\n            //         platform: FBInstant.getPlatform(),// 平台\n            //         sdkVersion: FBInstant.getSDKVersion(),// SDK 版本号\n            //     }\n            //     this.info.string = 'Context ID: ' + info.contextID + '\\n' +\n            //         'Context Type: ' + info.contextType + '\\n' +\n            //         'Locale: ' + info.locale + '\\n' +\n            //         'Platform: ' + info.platform + '\\n' +\n            //         'SDKVersion: ' + info.sdkVersion;\n            // }\n        }\n\n    },\n\n    init: function () {\n        if (typeof FBInstant != 'undefined') {\n            this.nick_name = FBInstant.player.getName();\n            this.id = FBInstant.player.getID();\n            this.head_url = FBInstant.player.getPhoto();\n\n            var info = {\n                contextID: FBInstant.context.getID(), // 游戏 ID\n                contextType: FBInstant.context.getType(), // 游戏类型\n                locale: FBInstant.getLocale(),  // 地区\n                platform: FBInstant.getPlatform(),// 平台\n                sdkVersion: FBInstant.getSDKVersion(),// SDK 版本号\n            }\n            this.info = 'Context ID: ' + info.contextID + '\\n' +\n                'Context Type: ' + info.contextType + '\\n' +\n                'Locale: ' + info.locale + '\\n' +\n                'Platform: ' + info.platform + '\\n' +\n                'SDKVersion: ' + info.sdkVersion;\n        } else if (CC_WECHATGAME) {\n\n            // wx.getUserInfo({\n            //     withCredentials:false,\n\n            //     success: function (res) {\n            //         var userInfo = res.userInfo\n            //         this.nick_name = userInfo.nickName\n            //         this.head_url = userInfo.avatarUrl\n\n            //         // var userInfo = res.userInfo\n            //         // var nickName = userInfo.nickName\n            //         // var avatarUrl = userInfo.avatarUrl\n            //         // var gender = userInfo.gender //性别 0：未知、1：男、2：女\n            //         // var province = userInfo.province\n            //         // var city = userInfo.city\n            //         // var country = userInfo.country\n            //     },\n            //     fail: function (res) {\n            //         console.log(\"getUserInfo失败\");\n            //     }\n            // })\n\n        } else {\n\n        }\n    },\n    // 分享功能\n    onShareGame(textstring = '') {\n        var titleText;\n        var pic_url = \"res/raw-assets/resources/share/sharePic4.jpg\";\n        if (typeof FBInstant != 'undefined') {\n            if (textstring.length > 1) {\n                titleText = textstring\n            } else {\n                titleText = this.nick_name + ' is asking for your help!'\n            }\n\n            FBInstant.shareAsync({\n                intent: 'SHARE',\n                image: this.getImgBase64(),\n                text: titleText,\n                data: { myReplayData: '...' },\n            }).then(() => {\n                // continue with the game.\n                console.log(\"continue with the game.\");\n            });\n        }\n        else if (CC_WECHATGAME) {\n            var pic_list = [];\n            for (var i = 0; i < 4; ++i) {\n                pic_list.push(\"sharePic\" + (i + 1) + \".jpg\")\n            }\n            var text_list = [];\n\n            text_list.push(\"来不及解释了，不想赶紧上车吗？\");\n            text_list.push(\"比比看谁才是真正的老司机\");\n            text_list.push(\"老司机带你在车辆中穿梭\");\n            text_list.push(\"再不来你的汽车要长草了\");\n\n            text_list.push(\"速度与激情9即将来袭\");\n            text_list.push(\"要比比看谁比较快吗？\");\n            text_list.push(\"看到他们驾车技术那么熟练，我也忍不住想试一把\");\n\n            text_list.push(\"司机开不好车竟然是在玩这个\");\n            text_list.push(\"果然没有人能拦住我的车！\");\n            text_list.push(\"居然有这样一款能够让你真正体验驾驶乐趣的游戏\");\n\n            ++ShareManager.show_count;\n            if (textstring.length > 1) {\n                if (textstring.indexOf(\"sharePic\") >= 0) {\n                    titleText = text_list[ShareManager.show_count % text_list.length];\n                    pic_url = \"res/raw-assets/resources/share/\" + pic_list[ShareManager.show_count % pic_list.length]\n                    console.log(\" ShareManager.show_count \" + ShareManager.show_count);\n                    console.log(\" ShareManager.  \" + titleText + \" ,\" + pic_url);\n\n                } else {\n                    titleText = textstring\n                    pic_url = \"res/raw-assets/resources/share/sharePic4.jpg\";\n                }\n\n            } else {\n                titleText = '求助 遇到困难了 快来帮帮我'\n            }\n            wx.shareAppMessage({//主动拉起转发，进入选择通讯录界面\n                title: titleText,\n                imageUrl: pic_url,\n                success: function (res) {\n                    console.log(\"shareAppMessage成功\");\n                },\n                fail: function (res) {\n                    console.log(\"shareAppMessage失败\");\n                }\n            })\n        } else {\n            console.log(\"不支持平台\");\n            return;\n        }\n    },\n\n    // 截屏返回 iamge base6，用于 Share\n    getImgBase64() {\n\n        if (typeof FBInstant != 'undefined') {\n            // let sp = cc.find('Canvas/New Sprite(Splash)').getComponent(cc.Sprite);\n            let target = cc.find('Canvas/sharePicSprite');\n            let width = 800, height = 400;\n            let renderTexture = new cc.RenderTexture(width, height);\n            renderTexture.begin();\n            target._sgNode.visit();\n            renderTexture.end();\n            //\n            let canvas = document.createElement('canvas');\n            let ctx = canvas.getContext('2d');\n            canvas.width = width;\n            canvas.height = height;\n            if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n                let texture = renderTexture.getSprite().getTexture();\n                let image = texture.getHtmlElementObj();\n                ctx.drawImage(image, 0, 0);\n            }\n            else if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\n                let buffer = gl.createFramebuffer();\n                gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\n                let texture = renderTexture.getSprite().getTexture()._glID;\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n                let data = new Uint8Array(width * height * 4);\n                gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\n                gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n                let rowBytes = width * 4;\n                for (let row = 0; row < height; row++) {\n                    let srow = height - 1 - row;\n                    let data2 = new Uint8ClampedArray(data.buffer, srow * width * 4, rowBytes);\n                    let imageData = new ImageData(data2, width, 1);\n                    ctx.putImageData(imageData, 0, row);\n                }\n            }\n            return canvas.toDataURL('image/png');\n        }\n    },\n\n    NavigateTo7cGameBox() {\n        if (CC_WECHATGAME) {\n            console.log(\"onBtnMoreGameClicked\");\n            if (wx.navigateToMiniProgram) {\n                wx.navigateToMiniProgram({\n                    appId: 'wxf9cf79aee55f7650',\n                    path: '',\n                    success(res) {\n                        console.log(\"MoreGame 打开成功\");\n                        // 打开成功\n                    }\n                })\n\n            } else {\n                wx.showModal({\n                    title: '提示',\n                    content: '当前微信版本过低，跳转小程序，无法使用该功能，请升级到最新微信版本后重试。'\n                });\n            }\n\n        }\n\n    }\n\n    // update (dt) {},\n});\nmodule.exports = ShareManager;"]}