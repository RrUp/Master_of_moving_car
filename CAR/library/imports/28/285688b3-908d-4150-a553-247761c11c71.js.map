{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/RankJS.js"],"names":["define","require","AdsManager","cc","Class","extends","Component","name","properties","groupFriendButton","Button","rankingScrollView","Sprite","mainNode","Node","onLoad","self","canvas","on","EventType","TOUCH_START","event","stopPropagation","node","TOUCH_MOVE","TOUCH_END","start","CC_WECHATGAME","window","wx","showShareMenu","withShareTicket","tex","Texture2D","console","log","director","getVisibleSize","k","getComponentInChildren","Label","string","friendButtonFunc","getInstance","hideBannerAD","postMessage","getOpenDataContext","active","messageType","MAIN_MENU_NUM","RankKey","showModal","title","content","groupFriendButtonFunc","titleText","shareAppMessage","imageUrl","success","res","shareTickets","undefined","length","shareTicket","gameOverButtonFunc","submitScoreButtonFunc","score","update","dt","_updateSubDomainCanvas","sharedCanvas","openDataContext","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame"],"mappings":"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","file":"RankJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var define = require(\"define\");\nvar AdsManager = require(\"AdsManagerJS\");\n\ncc.Class({\n    extends: cc.Component,\n    name: \"RankJS\",\n    properties: {\n        groupFriendButton: cc.Button,\n        // friendButton: cc.Node,\n        rankingScrollView: cc.Sprite,//显示排行榜\n\n        mainNode: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var self = this;\n        var canvas = self.mainNode\n        canvas.on(cc.Node.EventType.TOUCH_START, function (event) {\n            event.stopPropagation();\n        }, self.node);\n        canvas.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\n            event.stopPropagation();\n        }, self.node);\n        canvas.on(cc.Node.EventType.TOUCH_END, function (event) {\n            event.stopPropagation();\n        }, self.node);\n\n    },\n\n    start () {\n        if (CC_WECHATGAME) {\n            window.wx.showShareMenu({ withShareTicket: true });//设置分享按钮，方便获取群id展示群排行榜\n            this.tex = new cc.Texture2D();\n            console.log(\"rankingScrollView setContentSize \" + cc.director.getVisibleSize());\n            var k = 0.5;\n            //    this.rankingScrollView.node.setContentSize(cc.director.getVisibleSize());\n            // window.wx.postMessage({\n            //     messageType: 1,\n            //     MAIN_MENU_NUM: define.RankKey\n            // });\n        }\n        this.groupFriendButton.getComponentInChildren(cc.Label).string = '群排行'\n        cc.log(\"+========\", this.groupFriendButton.getComponentInChildren(cc.Label).string)\n        //GameDataManager.getInstance().getTextById(14);\n    },\n    friendButtonFunc(event) {\n        console.log(\" show 好友排行榜数据 \");\n        AdsManager.getInstance().hideBannerAD();\n        if (CC_WECHATGAME) {\n            if (window.wx.postMessage&&wx.getOpenDataContext) {\n                this.mainNode.active = true;\n                // 发消息给子域\n                window.wx.postMessage({\n                    messageType: 1,\n                    MAIN_MENU_NUM: define.RankKey\n                });\n            } else {\n                wx.showModal({\n                    title: '提示',\n                    content: '当前微信版本过低，好友排行榜，无法使用该功能，请升级到最新微信版本后重试。'\n                });\n            }\n\n        } else {\n            console.log(\"不支持 获取好友排行榜数据。x1\");\n        }\n    },\n\n    groupFriendButtonFunc: function (event) {\n        if (CC_WECHATGAME) {\n            var titleText = '90后女司机诚邀您决战秋名山'\n            window.wx.shareAppMessage({\n                title: titleText,\n                imageUrl: \"res/raw-assets/resources/share/sharePic4.jpg\",\n                success: (res) => {\n                    if (res.shareTickets != undefined && res.shareTickets.length > 0) {\n                        window.wx.postMessage({\n                            messageType: 5,\n                            MAIN_MENU_NUM: define.RankKey,\n                            shareTicket: res.shareTickets[0]\n                        });\n                    }\n                }\n            });\n        } else {\n            console.log(\"不支持 获取群排行榜数据。x1\");\n        }\n    },\n\n    gameOverButtonFunc: function (event) {\n        if (CC_WECHATGAME) {\n            window.wx.postMessage({// 发消息给子域\n                messageType: 4,\n                MAIN_MENU_NUM: define.RankKey\n            });\n        } else {\n            console.log(\"获取横向展示排行榜数据。x1\");\n        }\n    },\n\n    submitScoreButtonFunc(score) {\n        if (CC_WECHATGAME) {\n            window.wx.postMessage({\n                messageType: 3,\n                MAIN_MENU_NUM: define.RankKey,\n                score: score,\n            });\n        } else {\n            console.log(\"fail 提交得分 : \" + score)\n        }\n    },\n    update (dt) {\n        this._updateSubDomainCanvas();\n    },\n     // 刷新子域的纹理\n     _updateSubDomainCanvas() {\n        if (!this.tex) {\n            return;\n        }\n        if (window.sharedCanvas != undefined) {\n            if(wx.getOpenDataContext)\n            {\n                var openDataContext = wx.getOpenDataContext();\n                var sharedCanvas = openDataContext.canvas;\n                this.tex.initWithElement(sharedCanvas);\n                this.tex.handleLoadedTexture();\n                this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\n            }\n        }\n\n        // if (window.sharedCanvas != undefined) {\n        //     this.tex.initWithElement(window.sharedCanvas);\n        //     this.tex.handleLoadedTexture();\n        //     this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\n        // }\n    },\n});\n"]}