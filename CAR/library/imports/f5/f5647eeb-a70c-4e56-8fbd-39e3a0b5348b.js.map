{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/SelectDifficultSceneJS.js"],"names":["GameDataManager","require","cc","Class","extends","Component","properties","pageNum","stageDataArr","curPos","Vec2","difficultTitle","Sprite","pageTeample","default","type","Prefab","contextPageView","PageView","audioControl","onLoad","find","getComponent","content","console","log","initStageData","maxPackageCount","getInstance","getPackageCount","i","passCount","getMaxUnlockedStage","stageCount","getStageCount","stageData","addSubPage","addPage","_createPage","page","instantiate","position","v2","PACKAGE_IMAGE","data","imageViewPath","CompletionLabel","id","getResName","clickEventHandler","EventHandler","target","node","component","handler","customEventData","button","getComponentInChildren","Button","clickEvents","push","init","start","x","getSelectLevelPos","setContentPosition","scheduleOnce","pagePos","getLatestPackage","scrollToPage","enterGameStageCallback","event","playClick","packages","savePageviewPos","director","loadScene","curPage","getCurrentPageIndex","saveLatestPackage","getContentPosition","saveSelectLevelPos","back_btnClick"],"mappings":"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","file":"SelectDifficultSceneJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nvar GameDataManager = require(\"GameDataManagerJS\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        pageNum: 0,\n        stageDataArr: [],\n\n        curPos: cc.Vec2,\n        difficultTitle: cc.Sprite,\n        // pageTeample: cc.Prefab,//difficultsubpagelayout prefab\n        pageTeample: {\n            default: null,\n            type: cc.Prefab,\n        },\n        contextPageView: cc.PageView,\n        //content:cc.Node,\n        audioControl:\n        {\n            default: null,\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        this.content = cc.find('Canvas/DifficultPageView/view/content')\n        console.log(\"找到了\", this.content);\n        this.initStageData();\n\n    },\n    //初始化stagedata~~数组（难度，关卡）\n    initStageData: function () {\n        let maxPackageCount = GameDataManager.getInstance().getPackageCount();//传入4\n        for (let i = 0; i < maxPackageCount; i++) {\n            let passCount = GameDataManager.getInstance().getMaxUnlockedStage(i);\n            let stageCount = GameDataManager.getInstance().getStageCount(i);\n            console.log('stage ' + i + \" , \" + passCount + \"/ \" + stageCount);\n\n            let stageData = { passCount: 0, stageCount: 0 };\n            stageData.passCount = passCount;\n            stageData.stageCount = stageCount;\n            this.stageDataArr[i] = stageData;//数组（难度，关卡）\n        }\n        //循环添加四个难度页面\n        for (let i = 0; i < maxPackageCount; i++) {\n            this.addSubPage();\n        }\n    },\n    //创建、添加页面\n    addSubPage: function () {\n        // this._createPage();\n        this.contextPageView.addPage(this._createPage());//在当前页面视图的尾部插入一个新视图\n    },\n\n    // addPageView: function () {\n    //     this.contextPageView = new cc.PageView;\n    // },\n\n    //传入数据\n    _createPage() {\n        // this.content =cc.find('Canvas/DifficultPageView/view/content')\n        //cc.log(content);\n        console.log(\"-------------->>>test\");\n        var page = cc.instantiate(this.pageTeample);//实例化prefab\n        cc.log(\"预制体\", page)\n        // this.content.addChild(page);\n        page.position = new cc.v2(0, 0);//page位置 \n        // page.setPosition(0,0);\n        cc.log(\"一\", page.position)\n        let PACKAGE_IMAGE = [\"package_easy\", \"package_medium\", \"package_hard\", \"package_expert\"];\n        let i = this.pageNum;\n        let data = { imageViewPath: \"\", CompletionLabel: \"\", id: 0 };//CompletionLabel是prefeb里的label\n\n        data.imageViewPath = GameDataManager.getInstance().getResName(PACKAGE_IMAGE[i]);\n        cc.log(\"图片路径\", data.imageViewPath)\n        data.CompletionLabel = this.stageDataArr[i].passCount + \"/\" + this.stageDataArr[i].stageCount;\n        //label显示内容:通关数/总关卡数\n        var clickEventHandler = new cc.Component.EventHandler();\n        //target Node 目标节点  component String 目标组件名  handler String 响应事件函数名  customEventData String 自定义事件数据\n        clickEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n\n        clickEventHandler.component = \"SelectDifficultSceneJS\";//这个是代码文件名\n        clickEventHandler.handler = \"enterGameStageCallback\";//btn跳转事件\n        clickEventHandler.customEventData = this.pageNum;//自定义事件数据\n\n        var button = page.getComponentInChildren(cc.Button);//prefab中的button\n        button.clickEvents.push(clickEventHandler);\n\n        page.getComponent('subDifficultTemplateJS').init(data);//根据data传图\n\n        ++this.pageNum;\n        return page;\n    },\n\n    //设置位置\n    start() {\n        // let maxPackageCount = GameDataManager.getInstance().getPackageCount();\n\n        this.curPos = new cc.Vec2(0, 0);\n        this.curPos.x = GameDataManager.getInstance().getSelectLevelPos();\n        if (this.curPos.x >= 0) {\n            this.curPos.x = -375.0;\n        }\n        this.contextPageView.setContentPosition(this.curPos);//设置当前视图内容的坐标点\n\n        this.scheduleOnce(function () {\n\n            var pagePos = GameDataManager.getInstance().getLatestPackage();\n            this.contextPageView.scrollToPage(pagePos);\n\n        }, 0.01);\n    },\n\n\n\n    //btn跳转事件。_createPage中调用\n    enterGameStageCallback: function (event, customEventData) {\n        this.playClick();\n        //这里 event 是一个 Touch Event 对象，你可以通过 event.target 取到事件的发送节点\n        var node = event.target;//目标节点\n        cc.log(\"目标节点\", node)\n        var button = node.getComponent(cc.Button);\n        cc.log(\"获取btn\", button)\n        let packages = customEventData;\n        cc.log(\"获取packages\", packages)\n        // GameDataManager.getInstance().getPassTime();\n        this.playClick();\n        this.savePageviewPos();\n        cc.director.loadScene(\"ChooseStageScene\");\n    },\n    //记录package，LevelPos\n    savePageviewPos: function () {\n        let curPage = this.contextPageView.getCurrentPageIndex();//number\n        GameDataManager.getInstance().saveLatestPackage(curPage);//记录当前页面package\n\n        this.curPos = this.contextPageView.getContentPosition();//获取位置\n        GameDataManager.getInstance().saveSelectLevelPos(this.curPos.x);//记录难度选择界面LevelPos\n    },\n    // update (dt) {},\n    back_btnClick() {\n        this.playClick();\n        this.savePageviewPos();\n        cc.director.loadScene(\"main\");\n    },\n    playClick: function () {\n        if (this.audioControl) {\n            this.audioControl.playClick();\n        }\n    },\n});\n"]}