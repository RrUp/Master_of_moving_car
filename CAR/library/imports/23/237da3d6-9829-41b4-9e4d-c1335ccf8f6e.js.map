{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/LoadingSceneJS.js"],"names":["GameDataManager","require","define","point","isLoading","isAuthorization","cc","Class","extends","Component","properties","wxlog_btn","Node","loadingBar","type","ProgressBar","default","loadinglab","Sprite","loadingpercent","Label","titlebg","audioControl","testSprite","SpriteFrame","onLoad","game","on","sure","console","log","active","node","getInstance","preLoadingdata","getgold","savegold","money","getInfo","progress","CC_WECHATGAME","Promise","resolve","reject","wx","getSetting","success","res","authSetting","createUserInfoButton","button","text","style","left","top","width","height","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","getUserInfo","hide","nickName","userInfo","avatarUrl","emit","fail","authorize","scope","Login","self","login","res1","code","request","url","data","gameName","appid","secret","js_code","grant_type","header","method","res2","userID","openid","sys","localStorage","setItem","Date","getTime","wxGetUserState","errMsg","wxGetUserInfo","btnAuthorization","WXInfoButton","indexOf","guideActive","setUserData","show","showModal","title","content","showCancel","confirm","cancel","Name","AvatarUrl","pro","loader","load","err","newSprite","Avatra","onLoadComplete","director","loadScene","start","preloadScene","update","dt","string","Math","floor"],"mappings":"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","file":"LoadingSceneJS.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["var GameDataManager = require(\"GameDataManagerJS\");\nvar define = require(\"define\");\nlet point = 0;\nlet isLoading = false;\nlet isAuthorization = false;\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        wxlog_btn: cc.Node,\n        // bg_sprite: cc.Sprite,\n        loadingBar: {\n            type: cc.ProgressBar,\n            default: null\n        },\n        loadinglab: cc.Sprite,\n        loadingpercent: cc.Label,\n        titlebg: cc.Sprite,\n        audioControl:\n        {\n            default: null,\n        },\n        testSprite: cc.SpriteFrame\n        // btnAuthorization: cc.Node,\n    },\n\n    onLoad() {\n        // cc.sys.localStorage.clear();\n        cc.game.on(\"impower\", (sure) => {\n            if (sure) {\n                console.log(\"授权成功！\")\n                this.wxlog_btn.active = false;\n                this.loadingBar.node.active = true;\n                this.loadinglab.node.active = true;\n                this.loadingpercent.node.active = true;\n                // this.wxlog_btn.active=true;\n                GameDataManager.getInstance().preLoadingdata();//加载关卡数据(获取maxPackageCount、passCount、unlockCount)\n                // this.loadres();\n                //首次加载游戏\n                cc.log(\"############\", GameDataManager.getInstance().getgold())\n                if (!define.getgold()) {\n                    GameDataManager.getInstance().savegold(define.money);\n                    cc.log(\"@@@\", GameDataManager.getInstance().getgold())\n                }\n                //    }\n\n            }\n            else { }\n        })\n        this.getInfo();\n        this.loadingBar.progress = 0;//进度条\n        this.loadingBar.node.active = false;\n        this.loadinglab.node.active = false;\n        this.loadingpercent.node.active = false;\n        // this.loadingTime = 1;\n        if (!CC_WECHATGAME){console.log(\"授权成功！\")\n        this.wxlog_btn.active = false;\n        this.loadingBar.node.active = true;\n        this.loadinglab.node.active = true;\n        this.loadingpercent.node.active = true;\n        // this.wxlog_btn.active=true;\n        GameDataManager.getInstance().preLoadingdata();//加载关卡数据(获取maxPackageCount、passCount、unlockCount)\n        // this.loadres();\n        //首次加载游戏\n        cc.log(\"############\", GameDataManager.getInstance().getgold())\n        if (!define.getgold()) {\n            GameDataManager.getInstance().savegold(define.money);\n            cc.log(\"@@@\", GameDataManager.getInstance().getgold())\n        }\n    }\n                // if(cc.sys.localStorage.getItem(\"first_in\") == NaN){\n        //     cc.sys.localStorage.setItem(\"first_in\", 100);\n        // 游戏首次加载需要初始化的操作\n        //   }\n        //   this.audioControl = cc.find('AudioControlNode').getComponent('AudioSourceControl');\n        // (\" 常驻节点 赋值 \")\n\n        // cc.game.addPersistRootNode(this.node);\n        // cc.director.preloadScene('main', () => {//预加载\n        // });\n\n        // if (CC_WECHATGAME) {\n        //         isAuthorization = false;//未授权状态\n        //         this.Login();//获取openid\n        // }\n        // else {//网页测试用\n        //     isAuthorization = true;\n        //     this.loadingBar.node.active=true;\n        //     define.Name = 'testUser'//require('define')\n        //     define.Avatra = this.testSprite._texture;\n        //     console.log(define.Avatra)\n        //     this.scheduleOnce(function () {\n        //         Global.server.LoginServer();\n        //     }, 1)\n        // }\n    },\n    getInfo() {\n        return new Promise(function (resolve, reject) {\n            if (CC_WECHATGAME) {\n                wx.getSetting({\n                    success(res) {\n                        if (!res.authSetting['scope.userInfo']) {\n                            console.log('ç¨æ·è¿æ²¡ææï¼');\n                            if (wx.createUserInfoButton) {\n                                console.log(\"åå»ºæææé®\");\n                                let button = wx.createUserInfoButton({\n                                    type: 'text',\n                                    text: '',\n                                    style: {\n                                        left: 0,\n                                        top: 0,\n                                        width: 5000,\n                                        height: 5000,\n                                        lineHeight: 40,\n                                        backgroundColor: '',\n                                        color: '',\n                                        textAlign: 'center',\n                                        fontSize: 40,\n                                        borderRadius: 10\n                                    }\n                                });\n\n                                button.onTap(function () {\n                                    console.log('åºç°æææé®ï¼');\n                                    wx.getUserInfo({\n                                        success: function (res) {\n                                            button.hide();\n                                            define.nickName = res.userInfo.nickName;\n                                            define.avatarUrl = res.userInfo.avatarUrl;\n                                            console.log(\"æææå\");\n                                            cc.game.emit(\"impower\", true);\n                                            resolve();\n                                        },\n                                        fail: function (res) {\n                                            console.log(res);\n                                            console.log(\"ææå¤±è´¥\");\n                                            cc.game.emit(\"impower\", false);\n                                            reject();\n                                        }\n                                    });\n                                });\n                            } else {\n                                console.log(\"ä¸åå»ºæææé®\");\n                                wx.authorize({\n                                    scope: 'scope.userInfo',\n                                    success() {\n                                        wx.getUserInfo({\n                                            success: function (res) {\n                                                define.nickName = res.userInfo.nickName;\n                                                define.avatarUrl = res.userInfo.avatarUrl;\n                                                // G.LoadingManager.init();\n                                                resolve();\n                                            },\n                                            fail: function (res) {\n                                                reject();\n                                            }\n                                        })\n                                    }\n                                })\n                            }\n\n                        } else {\n                            console.log('ç¨æ·å·²ç»ææï¼');\n                            wx.getUserInfo({\n                                success: function (res) {\n                                    console.log('res', res);\n                                    define.nickName = res.userInfo.nickName;\n                                    define.avatarUrl = res.userInfo.avatarUrl;\n                                    cc.game.emit(\"impower\", true);\n                                    // G.LoadingManager.init();\n                                    resolve();\n                                },\n                                fail: function (res) {\n                                    reject();\n                                }\n                            })\n                        }\n                    }\n                })\n            } else {\n                console.log('æµè§å¨æ æ³ææï¼');\n                // G.LoadingManager.init();\n                resolve();\n            }\n        })\n    },\n\n\n\n    Login() {//拿OpenId\n        let self = this;\n        if (CC_WECHATGAME) {\n            wx.login({\n                success: function (res1) {\n                    if (res1.code) {\n                        wx.request({\n                            //测试\n                            url: 'https://www.7cgames.cn:8070/getOpenId',\n                            //生产\n                            //url: 'https://www.7cgames.cn:8070/getOpenId',\n                            data: {\n                                gameName: 'HeadKing',\n                                appid: 'wxe7da0f34550b5d3c',\n                                secret: '134aa23603b0ab1d8177c6ef65370f40',\n                                js_code: res1.code,\n                                grant_type: 'authorization_code',\n                            },\n                            header: {\n                                \"Content-Type\": \"application/json\"\n                            },\n                            method: 'POST',\n                            success: function (res2) {\n                                console.log('res2' + \"--------------\");\n                                console.log(res2);\n                                userID = res2.data.openid;\n                                if (!userID) {\n                                    // self.userID = '123';\n                                    console.log('self.userID!!!')\n                                }\n                                console.log(userID)\n                                cc.sys.localStorage.setItem('OpenId', userID);\n                                // console.log('userID' + userID)\n                                console.log('发起连接请求：' + (new Date()).getTime());\n                                self.wxGetUserState();\n                            },\n                            fail: function (res2) {\n                                console.log(\"openidGet Fail\", res2);\n\n                            }\n                        })\n                    } else {\n                        console.log('登录失败！' + res1.errMsg)\n                    }\n                }\n            });\n\n        }\n        else {\n            //  userID = 'oUQfI5QDgOnYS74rtdfMrBEwV0MM';\n\n        }\n    },\n    wxGetUserState: function () {\n\n        let self = this\n        wx.getSetting({\n            fail: function (res) {\n                self.wxGetUserInfo()\n                console.log('fail1')\n            },\n\n            success: function (res) {\n                if (res.authSetting['scope.userInfo']) {\n                    self.getUserInfo()\n                    self.btnAuthorization.active = false;\n                }\n                else {\n                    self.btnAuthorization.active = true;\n                    self.wxGetUserInfo()\n                    console.log('fail2')\n                }\n            }\n        })\n    },\n    wxGetUserInfo() {\n        let self = this;\n        //this.windowWidth\n        this.WXInfoButton = wx.createUserInfoButton({\n            type: 'text',\n            text: '',\n            style: {\n                left: 0,\n                top: 0,\n                width: 5000,\n                height: 5000,\n                lineHeight: 40,\n                backgroundColor: '',\n                color: '',\n                textAlign: 'center',\n                fontSize: 16,\n                borderRadius: 4\n            }\n        })\n        this.WXInfoButton.onTap((res) => {\n            if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                // 处理用户拒绝授权的情况\n                self.guideActive()\n            } else {\n                self.setUserData(res)\n                self.WXInfoButton.hide();\n            }\n\n        })\n        this.WXInfoButton.show()\n\n    },\n    getUserInfo() {\n        let self = this;\n        console.log('get info')\n        wx.getUserInfo({\n            fail: function (res) {\n                if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                    // 处理用户拒绝授权的情况\n                    self.guideActive()\n                }\n            },\n            success: function (res) {\n                console.log('get info success')\n                self.setUserData(res)\n            }\n        })\n    },\n    guideActive: function () {\n        wx.showModal({\n            title: '警告',\n            content: '拒绝授权将无法正常游戏',\n            //cancelText: '取消',\n            showCancel: false,\n            success(res) {\n                if (res.confirm) {\n                    console.log('用户点击确定')\n                } else if (res.cancel) {\n                    console.log('用户点击取消')\n                }\n            }\n        })\n    },\n    setUserData: function (res) {\n        console.log('login')\n        //console.log(res.userInfo)\n        define.Name = res.userInfo.nickName\n        define.AvatarUrl = res.userInfo.avatarUrl;\n        this.btnAuthorization.active = false;\n        this.pro.node.active = true;\n        isAuthorization = true;\n        cc.loader.load({ url: res.userInfo.avatarUrl, type: 'png' }, function (err, newSprite) {\n            define.Avatra = newSprite;\n        })\n        //Global.server.PostUserInfoByUserIdBindFun()//把获得头像数据发送给服务器\n        //**  Global.server.LoginServer(res.userInfo.nickName, res.userInfo.avatarUrl, userID);\n        // this.signature = res.signature\n        // this.encryptedData = res.encryptedData\n        // this.rawData = res.rawData\n        // this.iv = res.iv\n\n        // this.pro.node.active = true;\n    },\n    // loadres(dt) { \n    //     if (isAuthorization) {\n    //         cc.log(\"——————\",point)\n    //         point += dt; cc.log(\"+++++point\",point)\n    //         this.loadingBar.progress = ((point / 3) > 1 ? 1 : point / 3);\n    //         this.loadingpercent.string = Math.floor(this.loadingBar.progress * 100) + \"%\";\n    //     }\n    //     var self = this;\n    //     var loadingBar = this.loadingBar;\n    //     // var loadtext = this.loadtext;\n    //     // var login_button = this.login_button;\n    //     var jindu = 0;\n    //     self.is_loading = true;\n    //     cc.loader.onProgress = function (completedCount, totalCount, item) {\n    //         if (totalCount !== 0 && self.is_loading === true) {\n    //             jindu = completedCount / totalCount;\n    //         }\n    //         loadingBar.progress = jindu;\n    //         // var number_jindu = parseInt(jindu * 100);\n    //         // loadtext.string = number_jindu + '%';\n    //         cc.log(\"*******\",loadingBar.progress)\n    //     if(loadingBar.progress>=1){\n    //     self.onLoadComplete();};\n\n    // }\n\n    // },\n    onLoadComplete() {\n        cc.director.loadScene(\"main\");\n        // this.is_loading = false;\n        // // this.login_button.node.active = true;\n        // this.loadingBar.node.active = false;\n        // this.loadtext.node.active = false;\n        // cc.loader.onComplete = null;\n        //cc.vv.AudioAction.PlayBGM('bg_one.mp3');\n    },\n\n    //预加载、适配\n    start() {\n        cc.log(\"loading start\");\n        cc.director.preloadScene(\"main\", cc.log('预加载main'));\n        //适配\n        // console.log('    cc.winSize =' + cc.winSize);//以磅为单位返回WebGL视图的大小。它考虑了窗口的任何可能的旋转\n        // console.log('    cc.view.getVisibleSize() =' + cc.view.getVisibleSize());//返回正在运行的场景的可见大小\n        // console.log('    cc.view.getFrameSize() =' + cc.view.getFrameSize());//返回视图的帧大小。在本机平台上，它返回屏幕大小，因为视图是全屏视图。在Web上，它返回画布外部DOM元素的大小\n        // console.log('    cc.view.getDesignResolutionSize() =' + cc.view.getDesignResolutionSize());//返回视图的设计大小。默认分辨率大小与'getFrameSize'相同\n        // var DesignResolutionSize = cc.view.getDesignResolutionSize();\n        // var WinSize = cc.winSize;\n        // var nodeX = WinSize.width / DesignResolutionSize.width;\n        // var nodeY = WinSize.height / DesignResolutionSize.height;\n        // console.log('    nodeX=   ' + nodeX + '  nodeY=' + nodeY);\n\n    },\n\n    //进入main\n    // onEnterGame() {\n    //     console.log('loading onEnterGame!');\n    //     cc.director.loadScene(\"main\");\n    // },\n\n    // //加载完成回调main界面 \n    // _completeCallback: function (err, texture) {\n    //     console.log('第 ' + this.completeCount + '_completeCallback ');\n    //     this.onEnterGame();     //加载main界面 \n    // },\n    update(dt) {\n        if (this.loadingBar.progress >= 1 && isLoading == false) {\n            // cc.director.loadScene(\"main\");\n            isLoading = true;\n            this.onLoadComplete();\n        }\n        // if (isAuthorization) {\n        point += dt;\n        this.loadingBar.progress = ((point / 3) > 1 ? 1 : point / 3);\n        this.loadingpercent.string = Math.floor(this.loadingBar.progress * 100) + \"%\";\n        // }\n        //     var progress = this.loadingBar.progress;\n        //     if(progress<1){\n        //         progress+=dt/this.loadingTime;\n        //     this.loadingBar.progress =  progress ;  }\n        //     else cc.director.loadScene(\"main\");\n        //     // this.scheduleOnce(function () {\n        //     //     this.onEnterGame();\n        //     // }, 0.1);\n\n    },\n    // log_btnClick(){\n    //     if(isLoading = true){\n    //         cc.director.loadScene(\"main\");\n    //     }\n    // }\n});"]}